/*!
 * ----------------------------------------------------------
 *  HTML TEXT EDITOR PLUGIN 1.5.0
 * ----------------------------------------------------------
 * Author: Taufik Nurrohman <http://latitudu.com>
 * Licensed under the MIT license.
 *
 * REQUIRES:
 * ==========================================================
 * [1]. https://github.com/tovic/simple-text-editor-library
 * [2]. https://fortawesome.github.io/Font-Awesome/icons
 * ==========================================================
 * ----------------------------------------------------------
 *
 */

var HTE=function(e,t){function n(e){return void 0!==e}function r(e){return"string"==typeof e}function l(e){return"number"==typeof e}function a(e){return"function"==typeof e}function i(e){return"object"==typeof e}function o(e,t,n){return t="on"+t,null===n?e[t]=null:(a(e[t])&&(n=function(e,t){return function(){return e.apply(this,arguments),t.apply(this,arguments)}}(e[t],n)),void(e[t]=n))}function c(e,t){e=e||{};for(var n in t)e[n]=i(t[n])?c(e[n],t[n]):t[n];return e}function u(e,t){var n=t.replace(/\-(\w)/g,function(e,t){return t.toUpperCase()}),r=0;return r=X.defaultView&&X.defaultView.getComputedStyle?X.defaultView.getComputedStyle(e,null).getPropertyValue(t):e.style[n]}function s(e,t){return xt(e,function(){wt(t.end+1,!0)}),!1}function f(e){return e.replace(/^\s+|\s+$/g,"")}function p(e){return e.replace(/^\s+/,"")}function d(e){return e.replace(/\s+$/,"")}function g(e){return e.replace(Z.escape,"\\$1")}function h(e){return e.parentNode}function m(e,t){var n,r=$t(),l=e,a=Tt.LI,i=l.split(" ")[0],o=a.split(" ")[0];if(r.value.length){var c=/([\s\S]*?)<(?:ol|ul)(>| .*?>)([\s\S]*?)<\/(?:ol|ul)>([\s\S]*?)/g;r.value==t?wt():r.value.match(c)?Et(c,"$1<"+i+"$2$3</"+i+">$4"):Nt(gt,function(){xt("<"+l+">\n"+Tt.tabSize+"<"+a+">"+r.value.replace(/\n/g,"</"+o+">\n"+Tt.tabSize+"<"+a+">").replace(RegExp("\\n("+Tt.tabSize+")?<"+a+"><\\/"+o+">\\n","g"),"\n</"+i+">\n\n<"+l+">\n")+"</"+o+">\n</"+i+">")},gt,!0)}else if(r.after.match(RegExp("^<\\/"+o+">"))){var u=/(?:^|\n)([\t ]*).*?$/.exec(r.before),s=u?u[1]:"";xt("\n"+s+Tt.tabSize+"<"+l+">\n"+s+Tt.tabSize+Tt.tabSize+"<"+a+">"+t+"</"+o+">\n"+s+Tt.tabSize+"</"+i+">\n"+s,function(){n=$t().end-(i+Tt.tabSize+o+s+s).length-8,wt(n-t.length,n,!0)})}else r.before.match(/<\/(?:ol|ul)>\s?$/)?(mt.value=r.before.replace(/<(?:ol|ul)(>| .*?>)([\s\S]*?)<\/(?:ol|ul)>(\s?)$/g,"<"+i+"$1$2</"+i+">$3")+r.after,wt(r.end,!0)):Nt(gt,function(){xt("<"+l+">\n"+Tt.tabSize+"<"+a+">"+t+"</"+o+">\n</"+i+">",function(){r=$t(),n=r.end-(i+o).length-7,wt(n-t.length,n,!0)})},gt,!0)}var v="\u2018",x="\u2019",b="\u201C",k="\u201D",E="\u2013",w="\u2014",$="\u2026",C="\u00A6",y="\u00A9",R="\u2117",T="\u2120",L="\u2122",S="\u00AE",H="\u00B1",_="\u00D7",O="\u00F7",N="\u00B0",I="\u2039",M="\u203A",z="\u00AB",U="\u00BB",B="\u2264",A="\u2265",P="\u2260",K="\u2190",q="\u2192",D="\u2191",G="\u2193",F="\u21B5",Y="\u2318",Q="\u00B7",W="\u2116",j=this,V=window,X=document,Z=new Editor(e),J=function(){},et={tabSize:"    ",toolbar:!0,shortcut:!1,areaClass:"editor-area",toolbarClass:"editor-toolbar",toolbarIconClass:"fa fa-%s",toolbarButtonClass:"editor-toolbar-button editor-toolbar-button-%s",toolbarSeparatorClass:"editor-toolbar-separator",toolbarPosition:"before",dropClass:"custom-drop custom-drop-%s",modalClass:"custom-modal custom-modal-%s",modalHeaderClass:"custom-modal-header custom-modal-%s-header",modalContentClass:"custom-modal-content custom-modal-%s-content",modalFooterClass:"custom-modal-footer custom-modal-%s-footer",modalOverlayClass:"custom-modal-overlay custom-modal-%s-overlay",autoComplete:!0,autoIndent:!0,emptyElementSuffix:">",autoEncodeHTML:!0,P:"p",BR:"br",H_:"h%d",STRONG:"strong",EM:"em",U:"u",STRIKE:'del datetime="%Y-%m-%d"',UL:"ul",OL:"ol",LI:"li",HR:"hr",Q:"q",BLOCKQUOTE:"blockquote",CODE:"code",PRE:"pre",SUB:"sub",SUP:"sup",A:"a",IMG:"img",FIGURE:"figure",FIGCAPTION:"figcaption",actions:{ok:"OK",cancel:"Cancel",yes:"Yes",no:"No",open:"Open",close:"Close"},buttons:{bold:["Bold",Y+"+B"],italic:["Italic",Y+"+I"],underline:["Underline",Y+"+U"],strike:["Strike",Y+"+Delete"],superscript:["Superscript",Y+"+"+D],subscript:["Subscript",Y+"+"+G],code:["Code",Y+"+K"],paragraph:["Paragraph",Y+"+"+F],quote:["Quote",Y+"+Q"],heading:["H1 "+E+" H6",Y+"+H"],link:["Link",Y+"+L"],image:["Image",Y+"+G"],ol:["Ordered List",Y+"++"],ul:["Unordered List",Y+"+-"],rule:["Horizontal Rule",Y+"+R"],undo:["Undo",Y+"+Z"],redo:["Redo",Y+"+Y"]},placeholders:{text:"text goes here"+$,heading_text:"Heading",link_text:"link text",list_ul_text:"List item",list_ol_text:"List item",image_alt:"Image"},prompts:{link_title:"link title goes here"+$,link_title_title:"Link Title",link_url:"http://",link_url_title:"Link URL",image_title:"image caption goes here"+$,image_title_title:"Image Caption",image_url:"http://",image_url_title:"Image URL"},update:J,keydown:J,click:J,ready:J,copy:J,cut:J,paste:J},tt=X.body,nt=X.createElement("div"),rt=X.createElement("div"),lt=X.createElement("div"),at=0,it=null,ot=null,ct=0,ut=0,st=0,ft=0,pt=tt.parentNode.offsetWidth,dt=V.innerHeight>tt.parentNode.offsetHeight?V.innerHeight:tt.parentNode.offsetHeight,gt="\n\n",ht=" ",mt=e,vt=Z.indent,xt=Z.insert,bt=Z.key,kt=Z.outdent,Et=Z.replace,wt=Z.select,$t=Z.selection,Ct=Z.updateHistory,yt=Z.wrap,Rt=V.setTimeout,Tt=c(et,t),Lt=X.createElement("span");j.config=Tt,j.DOM={overlay:nt,modal:rt,drop:lt};{var St=(g(Tt.UL).replace(/\\[-+*]/g,"[-+*]"),g(Tt.OL).replace(/%d/g,"\\d+"),g(Tt.tabSize));g(Tt.PRE),g(Tt.BLOCKQUOTE)}j.shortcuts=[],j.shortcut=function(e,t){j.shortcuts[e.toLowerCase()]=t,j.shortcuts=function(){for(var e=Object.keys(j.shortcuts).sort().reverse(),t={},n=0,r=e.length;r>n;++n)t[e[n]]=j.shortcuts[e[n]];return t}()},j.event=function(e,t,n){return o(t,e,n)},j.modal=function(e,t,n){a(e)&&(n=t,t=e,e="default"),e=e||"default",n=n||{},at=tt.scrollTop||tt.parentNode.scrollTop,nt.className=Tt.modalOverlayClass.replace(/%s/g,e),rt.className=Tt.modalClass.replace(/%s/g,e),rt.innerHTML='<div class="'+Tt.modalHeaderClass.replace(/%s/g,e)+'"></div><div class="'+Tt.modalContentClass.replace(/%s/g,e)+'"></div><div class="'+Tt.modalFooterClass.replace(/%s/g,e)+'"></div>';var r=rt.style,l="left"in n,i="top"in n;r.visibility="hidden",Rt(function(){tt.appendChild(nt),tt.appendChild(rt)},.1),Rt(function(){var e=rt.offsetWidth,t=rt.offsetHeight;r.position="absolute",r.left=l?n.left+"px":"50%",r.top=i?n.top+"px":"50%",r.zIndex="9999",r.marginLeft=(l?0:0-e/2)+"px",r.marginTop=(i?0:at-t/2)+"px",r.visibility="",rt.offsetLeft<0&&!l&&(r.left=0,r.marginLeft=0,l=!0,n.left=0),rt.offsetTop<0&&!i&&(r.top=0,r.marginTop=0,i=!0,n.top=0);var a=rt.children[0];o(a,"mousedown",function(){return ot=rt,st=ct-ot.offsetLeft,ft=ut-ot.offsetTop,!1}),o(tt,"mousemove",null),o(tt,"mousemove",function(n){ct=n.pageX,ut=n.pageY+at;var a,o,c=l?0:e/2,u=i?0:t/2;if(null!==ot){var s=l?e:0,f=i?t:0;a=ct-st+c,o=ut-ft+u,c>a&&(a=c),u>o&&(o=u),a+c+s>pt&&(a=pt-c-s),o+u+f>dt&&(o=dt-u-f),r.left=a+"px",r.top=o-at+"px"}})},.2);var c=rt.children;a(t)&&t(nt,rt,c[0],c[1],c[2])},j.drop=function(e,t,n){a(e)&&(n=t,t=e,e="default"),!n&&it&&(n={left:it.offsetLeft,top:it.offsetTop+it.offsetHeight}),e=e||"default",n=n||{},at=tt.scrollTop||tt.parentNode.scrollTop,lt.className=Tt.dropClass.replace(/%s/g,e);var r=lt.style,l="left"in n,i="top"in n;r.visibility="hidden",Rt(function(){tt.appendChild(lt)},.1),Rt(function(){var e=lt.offsetWidth,t=lt.offsetHeight;r.position="absolute",r.left=l?n.left+"px":"50%",r.top=i?n.top+"px":"50%",r.zIndex="9999",r.marginLeft=(l?0:0-e/2)+"px",r.marginTop=(i?0:at-t/2)+"px",r.visibility="",n.left+e>pt&&(r.left=pt-e+"px",r.marginLeft=0),n.top+t>dt&&(r.top=dt-t+"px",r.marginTop=0)},.2),a(t)&&t(lt)},j.prompt=function(e,t,n,r,l){j.modal("prompt",function(l,i,c,u,s){var f=function(e){a(r)?(j.exit(),r(e)):j.exit(!0)},p=X.createElement("input");p.type="text",p.value=t,o(p,"keydown",function(e){var r=bt(e);if("escape"==r)return j.exit(!0),!1;if("arrowdown"==r)return d.focus(),!1;if(n){if("enter"==r&&""!==this.value&&this.value!==t)return f(this.value),!1}else if("enter"==r)return f(this.value==t?"":this.value),!1});var d=X.createElement("button");d.innerHTML=Tt.actions.ok,o(d,"click",function(){return n?""!==p.value&&p.value!==t&&f(p.value):f(p.value==t?"":p.value),!1});var g=X.createElement("button");g.innerHTML=Tt.actions.cancel,o(g,"click",function(){return j.exit(!0),!1}),o(d,"keydown",function(e){var t=bt(e);return"escape"==t?(j.exit(!0),!1):"arrowup"==t?(p.focus(),!1):"arrowright"==t?(g.focus(),!1):"arrowdown"==t||"arrowleft"==t?!1:void 0}),o(g,"keydown",function(e){var t=bt(e);return"escape"==t?(j.exit(!0),!1):"arrowup"==t?(p.focus(),!1):"arrowleft"==t?(d.focus(),!1):"arrowdown"==t||"arrowright"==t?!1:void 0}),c.innerHTML=e?e:"",u.appendChild(p),s.appendChild(d),s.appendChild(X.createTextNode(" ")),s.appendChild(g),Rt(function(){p.select()},.2)},l)},j.alert=function(e,t,n,r){j.modal("alert",function(r,l,i,c,u){var s=X.createElement("button");s.innerHTML=Tt.actions.ok,o(s,"click",function(){return a(n)?(j.exit(),n()):j.exit(!0),!1}),o(s,"keydown",function(e){return bt(e,"escape")?(j.exit(!0),!1):void 0}),i.innerHTML=e?e:"",c.innerHTML=t?t:"",u.appendChild(s),Rt(function(){s.focus()},.2)},r)},j.confirm=function(e,t,r,l){j.modal("confirm",function(l,i,c,u,s){var f=X.createElement("button");f.innerHTML=Tt.actions.ok,o(f,"click",function(){return n(r)&&a(r.OK)?(j.exit(),r.OK()):j.exit(!0),!1});var p=X.createElement("button");p.innerHTML=Tt.actions.cancel,o(p,"click",function(){return n(r)&&a(r.CANCEL)?(j.exit(),r.CANCEL()):j.exit(!0),!1}),o(f,"keydown",function(e){var t=bt(e);return"escape"==t?(j.exit(!0),!1):"arrowright"==t?(p.focus(),!1):"arrowleft"==t||"arrowdown"==t?!1:void 0}),o(p,"keydown",function(e){var t=bt(e);return"escape"==t?(j.exit(!0),!1):"arrowleft"==t?(f.focus(),!1):"arrowright"==t||"arrowdown"==t?!1:void 0}),c.innerHTML=e?e:"",u.innerHTML=t?t:"",s.appendChild(f),s.appendChild(X.createTextNode(" ")),s.appendChild(p),Rt(function(){p.focus()},.2)},l)},j.exit=j.close=function(e){if(it=null,ot=null,h(nt)&&tt.removeChild(nt),h(rt)&&tt.removeChild(rt),h(lt)&&tt.removeChild(lt),e&&e!==!1){var t=$t();i(e)||(e={}),wt("start"in e?e.start:t.start,"end"in e?e.end:t.end)}},o(V,"resize",function(){pt=tt.parentNode.offsetWidth,dt=V.innerHeight>tt.parentNode.offsetHeight?V.innerHeight:tt.parentNode.offsetHeight}),o(tt,"mouseup",function(){ot=null}),o(nt,"click",function(){j.exit(!0)}),j.scroll=function(e,t){l(e)?mt.scrollTop=e:mt.scrollTop+=parseInt(u(mt,"line-height"),10),a(t)&&t()},j.time=function(e){var t=new Date,r=t.getFullYear(),l=t.getMonth()+1,a=t.getDate(),i=t.getHours(),o=t.getMinutes(),c=t.getSeconds(),u=t.getMilliseconds();10>l&&(l="0"+l),10>a&&(a="0"+a),10>i&&(i="0"+i),10>o&&(o="0"+o),10>c&&(c="0"+c),10>u&&(u="0"+u);var s={Y:""+r,m:""+l,d:""+a,H:""+i,i:""+o,s:""+c,u:""+u};return n(e)?s[e]:s},Tt.toolbar&&(Lt.className=Tt.toolbarClass,o(Lt,"click",function(){return j.exit(!1),!1}),mt.parentNode.insertBefore(Lt,Tt.toolbarPosition.match(/^after|bottom$/i)?null:mt));var Ht=X.createElement("a");Ht.href="#esc:"+(new Date).getTime(),Ht.style.width=0,Ht.style.height=0,mt.parentNode.appendChild(Ht),j.button=function(e,t){if("|"===e)return j.separator(t);if(t=t||{},t.title!==!1){i(t.title)||(t.title=[t.title]);var n,c=X.createElement("a");if(c.className=Tt.toolbarButtonClass.replace(/%s/g,e),c.setAttribute("tabindex",-1),c.href="#"+e.replace(" ",":").replace(/[^a-z0-9\:]/gi,"-").replace(/-+/g,"-").replace(/^-|-$/g,""),c.innerHTML=t.text?t.text.replace(/%s/g,e):'<i class="'+Tt.toolbarIconClass.replace(/%s/g,e)+'"></i>',t.title[0]&&(c.title=t.title[0]),t.title[1]&&(c.title+=" ("+t.title[1]+")"),i(t.attr))for(var u in t.attr)if(r(t.attr[u])&&"+="==t.attr[u].slice(0,2)){var s=c.getAttribute(u)||"";c.setAttribute(u,s+t.attr[u].slice(2))}else c.setAttribute(u,t.attr[u]);o(c,"click",function(e){if(a(t.click)){var n=this.hash.replace("#","");return it=c,t.click(e,j),Tt.click(e,j,n),Tt.update(e,j,n),!1}}),o(c,"keydown",function(e){return bt(e,"escape")?(j.exit(!0),!1):void 0}),l(t.position)?(n=t.position<0?t.position+Lt.children.length+1:t.position-1,Lt.insertBefore(c,Lt.children[n]||null)):Lt.appendChild(c),et.buttons[e]=t}},j.separator=function(e){e=e||{};var t,n=X.createElement("span");if(n.className=Tt.toolbarSeparatorClass,i(e.attr))for(var a in e.attr)if(r(e.attr[a])&&"+="==e.attr[a].slice(0,2)){var o=n.getAttribute(a)||"";n.setAttribute(a,o+e.attr[a].slice(2))}else n.setAttribute(a,e.attr[a]);l(e.position)?(t=e.position<0?e.position+Lt.children.length+1:e.position-1,Lt.insertBefore(n,Lt.children[t]||null)):Lt.appendChild(n)},Z.tidy=function(e,t,r,l){r=n(r)?r:e;var i,o=$t(),c=-1===e.indexOf("\n")&&o.before.match(/\n$/),u=-1===r.indexOf("\n")&&o.after.match(/^\n/),s=c?o.before:d(o.before),g=f(o.value),h=u?o.after:p(o.after),m=s.length&&!c?e:"",v=h.length&&!u?r:"";return o.value.length&&!l&&a(t)?t(o):(mt.value=s+m+g+v+h,i=s.length+m.length,wt(i,i+g.length),void(a(t)&&t($t())))},Z.toggle=function(e,t,n,r){var l=$t();if(l.before.slice(-e.length)!=e&&l.after.slice(0,t.length)!=t)yt(e,t,!l.value.length&&r?function(){Et(/^/,r===!0?Tt.placeholders.text:r,n)}:!0);else{var a=l.before.slice(-e.length)==e?l.before.slice(0,-e.length):l.before,i=l.after.slice(0,t.length)==t?l.after.slice(t.length):l.after;mt.value=a+l.value+i,wt(a.length,(a+l.value).length,n||!0)}};var _t=0,Ot=Tt.buttons,Nt=Z.tidy,It=Z.toggle,Mt={bold:{title:Ot.bold,click:function(){var e=Tt.STRONG;Nt(ht,function(){It("<"+e+">","</"+e.split(" ")[0]+">",!0,!0)})}},italic:{title:Ot.italic,click:function(){var e=Tt.EM;Nt(ht,function(){It("<"+e+">","</"+e.split(" ")[0]+">",!0,!0)})}},underline:{title:Ot.underline,click:function(){var e=Tt.U;Nt(ht,function(){It("<"+e+">","</"+e.split(" ")[0]+">",!0,!0)})}},strikethrough:{title:Ot.strike,click:function(){var e=j.time(),t=Tt.STRIKE;t=t.replace(/%Y/g,e.Y).replace(/%m/g,e.m).replace(/%d/g,e.d).replace(/%H/g,e.H).replace(/%i/g,e.i).replace(/%s/g,e.s).replace(/%u/g,e.u),Nt(ht,function(){It("<"+t+">","</"+t.split(" ")[0]+">",!0,!0)})}},paragraph:{title:Ot.paragraph,click:function(){var e=$t(),t=Tt.P,n=t.split(" ")[0],r=g(n),l=Tt.placeholders.text;if(e.value.length)e.value==l?wt():RegExp("^<"+r+"(>| .*?>)|<\\/"+r+">$").test(e.value)?Et(RegExp("<"+r+"(>| .*?>)([\\s\\S]*?)<\\/"+r+">","g"),"$2"):(Et(/^/,"<"+t+">",J),Et(/$/,"</"+n+">",J),Et(/\n/g,"</"+n+">\n<"+t+">",J),Et(RegExp("<"+r+"(>| .*?>)<\\/"+r+">","g"),"",J),Et(RegExp("(<"+r+"(>| .*?>))+","g"),"$1",J),Et(RegExp("(<\\/"+r+">)+","g"),"$1"));else if(e.after.match(RegExp("^<\\/"+n+">")))yt("</"+n+">\n<"+t+">","",function(){Et(/^/,l)},!0);else{var a=!e.before.match(RegExp("<\\/"+n+">\\s*$")),i=!e.after.match(RegExp("^\\s*<"+n+"(>| .*?>)"));Nt(a?gt:"\n",function(){It("<"+t+">","</"+n+">",!0,!0)},i?gt:"\n",!0)}}},"quote-right":{title:Ot.quote,click:function(){var e=$t(),t=Tt.Q,n=Tt.BLOCKQUOTE;e.before.match(/(^|\n)$/)?Nt(gt,function(){It("<"+n+">\n","\n</"+n.split(" ")[0]+">",!0,!0)},gt,!e.before.match(/\n$/)):Nt(ht,function(){t=e.before.match(RegExp("<"+n.split(" ")[0]+"(>| .*?>)$"))?n:t,It("<"+t+">","</"+t.split(" ")[0]+">",!0,!0)})}},code:{title:Ot.code,click:function(){var e=$t(),t=Tt.CODE,n=Tt.PRE,r=t.split(" ")[0],l=n.split(" ")[0],a=!e.before.match(/(^|\n)$/),i=a?ht:gt,o=a?"<"+t+">":"<"+n+"><"+t+">",c=a?"</"+r+">":"</"+r+"></"+l+">";if(Nt(i,J,i,!a),e.value.length){var e=$t(),u=e.before,s=e.value,f=e.after,p=g(r),d=g(l);u.match(RegExp("(<"+d+"(>| .*?>))?<"+p+"(>| .*?>)s*$"))&&f.match(RegExp("^s*<\\/"+p+">(<\\/"+d+">)?"))?(u=u.replace(RegExp("(<"+d+"(>| .*?>))?<"+p+"(>| .*?>)$"),""),f=f.replace(RegExp("^<\\/"+p+">(<\\/"+d+">)?"),""),Tt.autoEncodeHTML&&(s=s.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">")),mt.value=u+s+f,wt(u.length,(u+s).length,!0)):(Tt.autoEncodeHTML&&(s=s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),mt.value=u+o+s+c+f,wt((u+o).length,(u+s+o).length,!0))}else It(o,c,!0,!0)}},header:{title:Ot.heading,click:function(){var e,t,n,r=$t(),l=Tt.H_,a=l.split(" ")[0],i=g(a).replace(/%d/g,"[1-6]"),o=Tt.P,c=o.split(" ")[0],u=g(c),s="<\\/?(?:"+i+"|"+u+")(>| .*?>)",h=d(r.before.replace(RegExp(s+"$"),"")),m=f(r.value.replace(RegExp("^"+s+"|"+s+"$","g"),"").replace(/\n+/g," ")),v=p(r.after.replace(RegExp("^"+s),"")),x=h.length?gt:"",b=v.length?gt:"",k=r.value.match(RegExp("^"+s))?RegExp("^"+s).exec(r.value):RegExp(s+"$").exec(r.before);if(k=k?k[1]:">",_t=6>_t?_t+1:0,r.value.length)r.before.match(RegExp(s+"$"))?(n=a.replace(/%d/g,_t),mt.value=h+x+"<"+(_t>0?n:c)+k+m+"</"+(_t>0?n:c)+">"+b+v,e=(h+x+k+(_t>0?n:c)).length+1):(t=l.replace(/%d/g,_t),n=a.replace(/%d/g,_t),mt.value=h+x+"<"+(_t>0?t:o)+k+m+"</"+(_t>0?n:c)+">"+b+v,e=h.length+x.length+1+(_t>0?t.length:o.length)+k.length),wt(e,e+m.length,!0);else{var E=Tt.placeholders.heading_text;l=l.replace(/%d/g,1),a=a.replace(/%d/g,1),_t=1,mt.value=d(r.before)+x+"<"+l+">"+E+"</"+a+">"+b+v,e=(d(r.before)+x+l).length+2,wt(e,e+E.length,!0)}}},link:{title:Ot.link,click:function(e){var t,n,r=$t(),l=Tt.A,a=l.split(" ")[0],i=Tt.placeholders.link_text;Ct(),j.prompt(Tt.prompts.link_url_title,Tt.prompts.link_url,!0,function(o){n=o;var c,u;-1!==n.indexOf("://")&&(c=!0),""!==V.location.host&&-1!==n.indexOf("://"+V.location.host)&&(c=!1),j.prompt(Tt.prompts.link_title_title,Tt.prompts.link_title,!1,function(o){u=c?' rel="nofollow" target="_blank"':"",Nt(ht,function(){t=o.replace(/'/g,"&apos;").replace(/"/g,"&quot;"),yt("<"+l+' href="'+n+'"'+(""!==t?' title="'+t+'"':"")+u+">","</"+a+">",r.value.length?!0:function(){Et(/^/,i)})}),Tt.update(e,j)})})}},image:{title:Ot.image,click:function(e){var t,n;Ct(),j.prompt(Tt.prompts.image_url_title,Tt.prompts.image_url,!0,function(r){t=r,j.prompt(Tt.prompts.image_title_title,Tt.prompts.image_title,!1,function(r){n=r,Nt(gt,function(){var e=$t(),r=f(e.value.length?e.value:decodeURIComponent(t.split("/").pop().replace(/\..*$/,"").replace(/[-+._]/g," ")).toLowerCase().replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()}));r.length||(r=Tt.placeholders.image_alt);var l="",a="",i=Tt.FIGURE,o=Tt.FIGCAPTION;""!==n&&(l="<"+i+">\n"+Tt.tabSize,a="\n"+Tt.tabSize+"<"+o+">"+n+"</"+o.split(" ")[0]+">\n</"+i.split(" ")[0]+">"),xt(l+"<"+Tt.IMG+' alt="'+r+'" src="'+t+'"'+Tt.emptyElementSuffix+a,function(){e=$t(),e.after.length||(mt.value+=gt),wt(e.end+2,!0)})},gt,!0),Tt.update(e,j)})})}},"list-ol":{title:Ot.ol,click:function(){m(Tt.OL,Tt.placeholders.list_ol_text)}},"list-ul":{title:Ot.ul,click:function(){m(Tt.UL,Tt.placeholders.list_ul_text)}},superscript:{title:Ot.superscript,click:function(){var e=Tt.SUP;Nt(ht,function(){It("<"+e+">","</"+e.split(" ")[0]+">",!0,!0)})}},subscript:{title:Ot.subscript,click:function(){var e=Tt.SUB;Nt(ht,function(){It("<"+e+">","</"+e.split(" ")[0]+">",!0,!0)})}},"ellipsis-h":{title:Ot.rule,click:function(){Nt(gt,function(){xt("<"+Tt.HR+Tt.emptyElementSuffix,function(){var e=$t();e.after.length||(mt.value+=gt),wt(e.end+2,!0)})})}},undo:{title:Ot.undo,click:Z.undo},repeat:{title:Ot.redo,click:Z.redo}};for(var zt in Mt)j.button(zt,Mt[zt]);o(mt,"focus",j.exit),o(mt,"copy",function(e){var t=$t();Rt(function(){Tt.copy(t),Tt.update(e,j)},.1)}),o(mt,"cut",function(e){var t=$t();Rt(function(){t.end=t.start,Tt.cut(t),Tt.update(e,j),Ct()},.1)}),o(mt,"paste",function(e){var t=$t();Rt(function(){t.end=$t().end,t.value=mt.value.substring(t.start,t.end),Tt.paste(t),Tt.update(e,j),Ct()},.1)}),o(mt,"keydown",function(e){var t=$t(),n=t.before,r=t.value,l=t.after,a=t.start,i=t.end,o=bt(e),c=e.ctrlKey,u=e.shiftKey,f=e.altKey,p="tab"==o;Rt(function(){Tt.keydown(e,j),Tt.update(e,j)},.1);for(var d in j.shortcuts){var h=d.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split(/\n/),m=0;for(var Y in h)(h[Y].match(/^ctrl|control|command|cmd|meta$/)&&c||"shift"==h[Y]&&u||h[Y].match(/^alt(ernate)?|option$/)&&f||"tab"==h[Y]&&p||h[Y]==o)&&m++;if(m===h.length)return j.shortcuts[d](e,j)}var V=n,X=l[0],et="\\"==V.slice(-1),tt=o==X;if(Tt.autoComplete&&!et){if(-1!==V.indexOf("(")&&")"==X&&tt||-1!==V.indexOf("{")&&"}"==X&&tt||-1!==V.indexOf("[")&&"]"==X&&tt||-1!==V.indexOf("<")&&">"==X&&tt||-1!==V.indexOf('"')&&'"'==X&&tt||-1!==V.indexOf("'")&&"'"==X&&tt||-1!==V.indexOf("`")&&"`"==X&&tt)return wt(i+1),!1;if("("==o)return s("("+r+")",t);if("{"==o)return s("{"+r+"}",t);if("["==o)return s("["+r+"]",t);if("<"==o)return s("<"+r+">",t);if('"'==o)return s('"'+r+'"',t);if(!n.match(/\w$/)){if("'"==o)return s("'"+r+"'",t);if("`"==o&&!n.match(/\w$/))return s("`"+r+"`",t)}}if(u&&p)return kt(Tt.tabSize),!1;if(p){if(n.match(/<[^\/>]*?$/)&&">"==l[0]){var nt=/<([^\/>]*?)$/.exec(n),rt=nt[1].split(" ")[0];return mt.value=rt.match(/^hr|img|link|meta$/)?n+" "+Tt.emptyElementSuffix+l.substring(1):n+" ></"+rt+l,wt(a+1,!0),!1}return vt(Tt.tabSize),!1}if(c&&"z"==o)return Z.undo(),!1;if(c&&"y"==o)return Z.redo(),!1;if(Tt.toolbar&&Tt.shortcut&&c){if("b"==o)return Mt.bold.click(),!1;if("g"==o)return Mt.image.click(),!1;if("h"==o)return Mt.header.click(),!1;if("i"==o)return Mt.italic.click(),!1;if(!u&&"k"==o)return Mt.code.click(),!1;if("l"==o)return Mt.link.click(),!1;if("q"==o)return Mt["quote-right"].click(),!1;if("r"==o)return Mt["ellipsis-h"].click(),!1;if("u"==o)return Mt.underline.click(),!1;if(r.length&&"delete"==o)return Mt.strikethrough.click(),!1;if("+"==o)return Mt["list-ol"].click(),!1;if("-"==o)return Mt["list-ul"].click(),!1;if("arrowup"==o)return Mt.superscript.click(),!1;if("arrowdown"==o)return Mt.subscript.click(),!1}if("enter"==o){if(f&&!r.length)return xt(F),!1;if(Tt.toolbar&&c)return Mt.paragraph.click(),!1;if(Tt.toolbar&&u)return xt("<"+Tt.BR+Tt.emptyElementSuffix+"\n"),j.scroll(),!1;if(Tt.toolbar){var lt=Tt.LI.split(" ")[0],at=g(lt);if(n.match(RegExp("<\\/"+at+">$"))){var nt=RegExp("(?:^|\\n)([\\t ]*)<"+at+"(>| .*?>).*?<\\/"+at+">$").exec(n);return xt("\n"+nt[1]+"<"+lt+nt[2]+"</"+lt+">",function(){wt(i+(nt[1]+nt[2]).length+4,!0)}),j.scroll(),!1}if(l.match(RegExp("^<\\/"+at+">"))&&">"!=n.slice(-1)){var nt=RegExp("(?:^|\\n)([\\t ]*)<"+at+"(>| .*?>).*$").exec(n);return xt("</"+lt+">\n"+nt[1]+"<"+lt+nt[2]),j.scroll(),!1}var it=Tt.P.split(" ")[0],ot=g(it);if(l.match(RegExp("^<\\/"+ot+">"))){var nt=RegExp("(?:^|\\n?)([\\t ]*)<"+ot+"(>| .*?>).*$").exec(n);return xt("</"+it+">\n"+nt[1]+"<"+it+nt[2]),j.scroll(),!1}}if(Tt.autoIndent){var ct=RegExp("(?:^|\\n)(("+St+")+)(.*?)$").exec(n),ut=ct?ct[1]:"";if(n.match(/[\(\{\[]$/)&&l.match(/^[\]\}\)]/)||n.match(/<[^\/]*?>$/)&&l.match(/^<\//))return xt("\n"+ut+St+"\n"+ut,function(){wt(a+(ut+Tt.tabSize).length+1,!0)}),j.scroll(),!1;if(n.match(RegExp(St+"$")))return xt("\n"+ut),j.scroll(),!1}}var st={"'":x,'"':k,"---":w,"--":E,"...":$,"|":C,"(c)":y,"(C)":y,"(p)":R,"(P)":R,"(sm)":T,"(SM)":T," sm":T," SM":T,"(tm)":L,"(TM)":L," tm":L," TM":L,"(r)":S,"(R)":S,"+-":H,"-+":H,x:_,"/":O,"^":N,"<<":z,">>":U,"<":I,">":M,"<=":B,">=":A,"!=":P,"No.":W,".":Q};if(r.length){if(f){Et(/'([^']*?)'/g,v+"$1"+x,J),Et(/"([^"]*?)"/g,b+"$1"+k,J);for(var d in st)Et(RegExp(g(d),"g"),st[d],J);return Ct(),!1}}else{if(f){if(-1!==n.indexOf('"')&&'"'==l[0])return mt.value=n.replace(/"([^"]*?)$/,b+"$1")+k+l.slice(1),wt(i,!0),!1;if(-1!==n.indexOf("'")&&"'"==l[0])return mt.value=n.replace(/'([^']*?)$/,v+"$1")+x+l.slice(1),wt(i,!0),!1;if(n.slice(-2).match(/\w'$/i))return mt.value=n.slice(0,-1)+x+l,wt(i,!0),!1;if(n.slice(-2).match(/(^|\W)'$/i))return mt.value=n.slice(0,-1)+v+l,wt(i,!0),!1;if(n.match(/\((c|p|sm|tm|r)$/i)&&")"==l[0]){var ft=n.match(/\((sm|tm)$/i)?2:1;return mt.value=n.slice(0,-(ft+1))+st["("+n.slice(-ft).toLowerCase()+")"]+l.slice(1),wt(i-ft,!0),!1}var pt=n.replace(/&lt;/g,"<").replace(/&gt;/g,">"),dt=l.replace(/&lt;/g,"<").replace(/&gt;/g,">");if(-1!==pt.indexOf("<<")&&0===dt.indexOf(">>"))return mt.value=n.replace(/(?:<<|&lt;&lt;)([^<]*)$/,z+"$1")+l.replace(/^(?:>>|&gt;&gt;)/,U),wt(pt.length-1,!0),!1;if(-1!==pt.indexOf("<")&&0===dt.indexOf(">"))return mt.value=n.replace(/(?:<|&lt;)([^<]*)$/,I+"$1")+l.replace(/^(?:>|&gt;)/,M),wt(pt.length,!0),!1;for(var d in st)if(n.slice(-d.length)==d)return mt.value=n.slice(0,-d.length)+st[d]+l,wt(a-d.length+1,!0),!1;if("arrowleft"==o)return xt(K),!1;if("arrowup"==o)return xt(D),!1;if("arrowright"==o)return xt(q),!1;if("arrowdown"==o)return xt(G),!1}if("delete"==o&&l.match(/^<\/[^\n>]*?>/))return mt.value=n+l.replace(/^<\/[^\n>]*?>/,""),wt(a,!0),!1;if("backspace"==o){if(n.match(RegExp("(^|\\n)("+St+")+$")))return kt(Tt.tabSize),!1;if(n.match(/<\/?[^\n>]*?>$/))return kt("<\\/?[^\\n>]*?>",!0,!0),!1;switch(n.slice(-1)){case"(":return It("(",")"),!1;case"{":return It("{","}"),!1;case"[":return It("[","]"),!1;case"<":return It("<",">"),!1;case'"':return It('"','"'),!1;case"'":return It("'","'"),!1;case" ":return It(" "," "),!1;case b:return It(b,k),!1;case v:return It(v,x),!1;case z:return It(z,U),!1;case I:return It(I,M),!1}}}return"escape"==o?(Ht.focus(),!1):void(f||c||u||Rt(Ct,.1))});var Ut=RegExp("(^|\\s)"+Tt.areaClass+"(\\s|$)"),Bt=mt.className;Bt.match(Ut)||(mt.className=f(Bt+" "+Tt.areaClass)),Tt.ready(j),j.grip=Z,j.grip.config=Tt};