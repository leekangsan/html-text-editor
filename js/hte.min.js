/*!
 * ----------------------------------------------------------
 *  HTML TEXT EDITOR PLUGIN 1.1.2
 * ----------------------------------------------------------
 * Author: Taufik Nurrohman <http://latitudu.com>
 * Licensed under the MIT license.
 *
 * REQUIRES:
 * ==========================================================
 * [1]. https://github.com/tovic/simple-text-editor-library
 * [2]. https://fortawesome.github.io/Font-Awesome/icons
 * ==========================================================
 * ----------------------------------------------------------
 *
 */

var HTE=function(e,t){function n(e){return void 0!==e}function l(e){return"string"==typeof e}function r(e){return"number"==typeof e}function i(e){return"function"==typeof e}function a(e){return"object"==typeof e}function o(e,t,n){t="on"+t,i(e[t])&&(n=function(e,t){return function(){return e.apply(this,arguments),t.apply(this,arguments)}}(e[t],n)),e[t]=n}function c(e,t){e=e||{};for(var n in t)e[n]=a(t[n])?c(e[n],t[n]):t[n];return e}function s(e,t){var n=t.replace(/\-(\w)/g,function(e,t){return t.toUpperCase()}),l=0;return l=G.defaultView&&G.defaultView.getComputedStyle?G.defaultView.getComputedStyle(e,null).getPropertyValue(t):e.style[n]}function u(e,t){return at(e,function(){st(t.end+1,ft)}),!1}function f(e){return e.replace(/^\s+|\s+$/g,"")}function p(e){return e.replace(/^\s+/,"")}function d(e){return e.replace(/\s+$/,"")}function g(e){return e.replace(Q.escape,"\\$1")}function h(e){return e.parentNode}function m(e,t){var n,l=ut(),r=e,i=dt.LI,a=r.split(" ")[0],o=i.split(" ")[0];l.value.length>0?l.value==t?st(l.start,l.end):at("<"+r+">\n"+dt.tabSize+"<"+i+">"+l.value.replace(/\n/g,"</"+o+">\n"+dt.tabSize+"<"+i+">").replace(RegExp("\\n("+dt.tabSize+")?<"+i+"><\\/"+o+">\\n","g"),"\n</"+a+">\n\n<"+r+">\n")+"</"+o+">\n</"+a+">"):at("<"+r+">\n"+dt.tabSize+"<"+i+">"+t+"</"+o+">\n</"+a+">",function(){n=l.start+1+r.length+2+dt.tabSize.length+1+i.length+1,st(n,n+t.length,ft)})}"prompt"in t&&(t.prompts=t.prompt),"placeholder"in t&&(t.placeholders=t.placeholder),"iconClassPrefix"in t&&(t.toolbarIconClass=t.iconClassPrefix+"%s"),"buttonClassPrefix"in t&&(t.toolbarButtonClass=t.buttonClassPrefix+"%s");var v="\u2018",b="\u2019",x="\u201C",C="\u201D",k="\u2013",E="\u2014",T="\u2026",y="\u00A6",L="\u00A9",$="\u2117",O="\u2120",R="\u2122",_="\u00AE",H="\u00B1",S="\u00D7",M="\u00F7",I="\u00B0",w="\u2039",N="\u203A",U="\u00AB",P="\u00BB",B="\u2264",A="\u2265",z="\u2260",K="\u2190",D="\u2192",Y="\u2191",q="\u2193",V="\u21B5",W=this,F=window,G=document,Q=new Editor(e),j={tabSize:"    ",toolbar:!0,shortcut:!1,areaClass:"editor-area",toolbarClass:"editor-toolbar",toolbarIconClass:"fa fa-%s",toolbarButtonClass:"editor-toolbar-button editor-toolbar-button-%s",toolbarSeparatorClass:"editor-toolbar-separator",toolbarPosition:"before",dropClass:"custom-drop custom-%s-drop",modalClass:"custom-modal custom-modal-%s",modalHeaderClass:"custom-modal-header custom-modal-%s-header",modalContentClass:"custom-modal-content custom-modal-%s-content",modalFooterClass:"custom-modal-action custom-modal-%s-action",modalOverlayClass:"custom-modal-overlay custom-modal-%s-overlay",emptyElementSuffix:">",autoEncodeHTML:!0,P:"p",BR:"br",H_:"h%d",STRONG:"strong",EM:"em",U:"u",STRIKE:'del datetime="%Y-%m-%d"',UL:"ul",OL:"ol",LI:"li",HR:"hr",QUOTE:"q",BLOCKQUOTE:"blockquote",CODE:"code",PRE:"pre",SUB:"sub",SUP:"sup",A:"a",IMG:"img",buttons:{ok:"OK",yes:"Yes",no:"No",cancel:"Cancel",open:"Open",close:"Close",bold:"Bold",italic:"Italic",underline:"Underline",strike:"Strike",superscript:"Superscript",subscript:"Subscript",code:"Code",paragraph:"Paragraph",quote:"Quote",heading:"H1 "+k+" H6",link:"Link",image:"Image",ol:"Ordered List",ul:"Unordered List",rule:"Horizontal Rule",undo:"Undo",redo:"Redo"},prompts:{link_title:"link title goes here"+T,link_title_title:"Link Title",link_url:"http://",link_url_title:"Link URL",image_url:"http://",image_url_title:"Image URL"},placeholders:{text:"text goes here"+T,heading_text:"Heading",link_text:"link text",list_ul_text:"List Item",list_ol_text:"List Item",image_alt:"Image"},keydown:function(){},click:function(){},ready:function(){},copy:function(){},cut:function(){},paste:function(){}},X=G.body,J=G.createElement("div"),Z=G.createElement("div"),et=G.createElement("div"),tt=null,nt=0,lt=function(){},rt=e,it=Q.indent,at=Q.insert,ot=Q.outdent,ct=Q.replace,st=Q.select,ut=Q.selection,ft=Q.updateHistory,pt=Q.wrap,dt=c(j,t),gt=G.createElement("span"),ht=g(dt.tabSize),mt=g(dt.P.split(" ")[0]),vt=g(dt.LI.split(" ")[0]);W.event=function(e,t,n){return o(t,e,n)};var bt=0,xt=0,Ct=0,kt=0,Et=null;W.modal=function(e,t,n){i(e)&&(n=t,t=e,e="default"),e=e||"default",n=n||{},nt=X.scrollTop||G.documentElement.scrollTop,J.className=dt.modalOverlayClass.replace(/%s/g,e),Z.className=dt.modalClass.replace(/%s/g,e),Z.innerHTML='<div class="'+dt.modalHeaderClass.replace(/%s/g,e)+'"></div><div class="'+dt.modalContentClass.replace(/%s/g,e)+'"></div><div class="'+dt.modalFooterClass.replace(/%s/g,e)+'"></div>';var l=Z.style,r="left"in n,a="top"in n;l.visibility="hidden",X.appendChild(J),X.appendChild(Z),F.setTimeout(function(){var e=Z.offsetWidth,t=Z.offsetHeight,i=J.offsetWidth,c=J.offsetHeight;l.position="absolute",l.left=r?n.left+"px":"50%",l.top=a?n.top+"px":"50%",l.zIndex="9999",l.marginLeft=(r?0:0-e/2)+"px",l.marginTop=(a?0:nt-t/2)+"px",l.visibility="",Z.offsetLeft<0&&!r&&(l.left=0,l.marginLeft=0),Z.offsetTop<0&&!a&&(l.top=0,l.marginTop=0);var s=Z.children[0];o(s,"mousedown",function(){return Et=Z,Ct=bt-Et.offsetLeft,kt=xt-Et.offsetTop,!1}),o(X,"mousemove",function(n){bt=n.pageX,xt=n.pageY+nt;var o,s,u=r?0:e/2,f=a?0:t/2;if(null!==Et){var p=r?e:0,d=a?t:0;o=bt-Ct+u,s=xt-kt+f,u>o&&(o=u),f+nt>s&&(s=f+nt),o+u+p>i&&(o=i-u-p),s+f+d>c+nt&&(s=c-f-d+nt),l.left=o+"px",l.top=s-nt+"px"}}),o(X,"mouseup",function(){Et=null})},10),i(t)&&t(J,Z)},W.drop=function(e,t,n){i(e)&&(n=t,t=e,e="default"),!n&&tt&&(n={left:tt.offsetLeft,top:tt.offsetTop+tt.offsetHeight}),e=e||"default",nt=X.scrollTop||G.documentElement.scrollTop,et.className=dt.dropClass.replace(/%s/g,e);var l=et.style,r="left"in n,a="top"in n;l.visibility="hidden",X.appendChild(et),F.setTimeout(function(){var e=et.offsetWidth,t=et.offsetHeight,i=X.offsetWidth,o=X.offsetHeight;l.position="absolute",l.left=r?n.left+"px":"50%",l.top=a?n.top+"px":"50%",l.zIndex="9999",l.marginLeft=(r?0:0-e/2)+"px",l.marginTop=(a?0:nt-t/2)+"px",l.visibility="",n.left+e>i&&(l.left=i-e+"px",l.marginLeft=0),n.top+t>o&&(l.top=o-t+"px",l.marginTop=0)},10),i(t)&&t(et)},W.prompt=function(e,t,n,l,r){W.modal("prompt",function(r,a){var c=function(e){i(l)?(W.close(),l(e)):W.close(!0)},s=G.createElement("input");s.type="text",s.value=t,o(s,"keydown",function(e){if(n){if(13==e.keyCode&&""!==this.value&&this.value!==t)return c(this.value),!1}else if(13==e.keyCode)return c(this.value==t?"":this.value),!1});var u=G.createElement("button");u.innerHTML=dt.buttons.ok,o(u,"click",function(){return n?""!==s.value&&s.value!==t&&c(s.value):c(s.value==t?"":s.value),!1});var f=G.createElement("button");f.innerHTML=dt.buttons.cancel,o(f,"click",function(){return W.close(!0),!1}),a.children[0].innerHTML=e?e:"",a.children[1].appendChild(s),a.children[2].appendChild(u),a.children[2].appendChild(G.createTextNode(" ")),a.children[2].appendChild(f),F.setTimeout(function(){s.select()},10)},r)},W.alert=function(e,t,n,l){W.modal("alert",function(l,r){var a=G.createElement("button");a.innerHTML=dt.buttons.ok,o(a,"click",function(){return i(n)?(W.close(),n()):W.close(!0),!1}),r.children[0].innerHTML=e?e:"",r.children[1].innerHTML=t?t:"",r.children[2].appendChild(a)},l)},W.confirm=function(e,t,l,r){W.modal("confirm",function(r,a){var c=G.createElement("button");c.innerHTML=dt.buttons.ok,o(c,"click",function(){return n(l)&&i(l.OK)?(W.close(),l.OK()):W.close(!0),!1});var s=G.createElement("button");s.innerHTML=dt.buttons.cancel,o(s,"click",function(){return n(l)&&i(l.CANCEL)?(W.close(),l.CANCEL()):W.close(!0),!1}),a.children[0].innerHTML=e?e:"",a.children[1].innerHTML=t?t:"",a.children[2].appendChild(c),a.children[2].appendChild(G.createTextNode(" ")),a.children[2].appendChild(s)},r)},W.close=function(e){if(Et=null,h(J)&&X.removeChild(J),h(Z)&&X.removeChild(Z),h(et)&&X.removeChild(et),e&&e!==!1){var t=ut();a(e)||(e={}),st("start"in e?e.start:t.start,"end"in e?e.end:t.end)}},W.scroll=function(e,t){r(e)?rt.scrollTop=e:rt.scrollTop+=parseInt(s(rt,"line-height"),10),i(t)&&t()},W.time=function(e){var t=new Date,l=t.getFullYear(),r=t.getMonth()+1,i=t.getDate(),a=t.getHours(),o=t.getMinutes(),c=t.getSeconds(),s=t.getMilliseconds();10>r&&(r="0"+r),10>i&&(i="0"+i),10>a&&(a="0"+a),10>o&&(o="0"+o),10>c&&(c="0"+c),10>s&&(s="0"+s);var u={Y:""+l,m:""+r,d:""+i,H:""+a,i:""+o,s:""+c,u:""+s};return n(e)?u[e]:u},dt.toolbar&&(gt.className=dt.toolbarClass,rt.parentNode.insertBefore(gt,"before"==dt.toolbarPosition?rt:null));var Tt=G.createElement("a");Tt.href="#esc:"+(new Date).getTime(),Tt.style.width=0,Tt.style.height=0,rt.parentNode.appendChild(Tt),o(J,"click",function(){W.close(!0)}),W.button=function(e,t){if("|"===e)return W.separator(t);if(t=t||{},t.title!==!1){var n,c=G.createElement("a");if(c.className=dt.toolbarButtonClass.replace(/%s/g,e),c.setAttribute("tabindex",-1),c.href="#"+e.replace(" ",":").replace(/[^a-z0-9\:]/gi,"-").replace(/-+/g,"-").replace(/^-|-$/g,""),c.innerHTML=t.text?t.text.replace(/%s/g,e):'<i class="'+dt.toolbarIconClass.replace(/%s/g,e)+'"></i>',t.title&&(c.title=t.title),a(t.attr))for(var s in t.attr)if(l(t.attr[s])&&"+="==t.attr[s].slice(0,2)){var u=c.getAttribute(s)||"";c.setAttribute(s,u+t.attr[s].slice(2))}else c.setAttribute(s,t.attr[s]);o(c,"click",function(e){return i(t.click)?(W.close(),tt=c,t.click(e,W),dt.click(e,W,this.hash.replace("#","")),!1):void 0}),r(t.position)?(n=t.position<0?t.position+gt.children.length+1:t.position-1,gt.insertBefore(c,gt.children[n]||null)):gt.appendChild(c),j.buttons[e]=t}},W.separator=function(e){e=e||{};var t,n=G.createElement("span");if(n.className=dt.toolbarSeparatorClass,a(e.attr))for(var i in e.attr)if(l(e.attr[i])&&"+="==e.attr[i].slice(0,2)){var o=n.getAttribute(i)||"";n.setAttribute(i,o+e.attr[i].slice(2))}else n.setAttribute(i,e.attr[i]);r(e.position)?(t=e.position<0?e.position+gt.children.length+1:e.position-1,gt.insertBefore(n,gt.children[t]||null)):gt.appendChild(n)},Q.toggle=function(e,t,n,l){var r=ut();if(r.before.slice(-e.length)!=e&&r.after.slice(0,t.length)!=t)pt(e,t,0===r.value.length&&l?function(){ct(/^.*$/,l===!0?dt.placeholders.text:l)}:1);else{var a=r.before.slice(-e.length)==e?r.before.slice(0,-e.length):r.before,o=r.after.slice(0,t.length)==t?r.after.slice(t.length):r.after;rt.value=a+r.value+o,st(a.length,a.length+r.value.length,ft)}i(n)&&n()};var yt=Q.toggle,Lt=0,$t=dt.buttons;if(a($t)){var Ot={bold:{title:$t.bold,click:function(){var e=dt.STRONG;yt("<"+e+">","</"+e.split(" ")[0]+">",1,!0)}},italic:{title:$t.italic,click:function(){var e=dt.EM;yt("<"+e+">","</"+e.split(" ")[0]+">",1,!0)}},underline:{title:$t.underline,click:function(){var e=dt.U;yt("<"+e+">","</"+e.split(" ")[0]+">",1,!0)}},strikethrough:{title:$t.strike,click:function(){var e=W.time(),t=dt.STRIKE;t=t.replace(/%Y/g,e.Y).replace(/%m/g,e.m).replace(/%d/g,e.d).replace(/%H/g,e.H).replace(/%i/g,e.i).replace(/%s/g,e.s).replace(/%u/g,e.u),yt("<"+t+">","</"+t.split(" ")[0]+">",1,!0)}},code:{title:$t.code,click:function(){var e=ut().value,t=dt.CODE,n=dt.PRE,l=t.split(" ")[0],r=n.split(" ")[0],i=-1===e.indexOf("\n"),a=i?"<"+t+">":"<"+n+"><"+t+">",o=i?"</"+l+">":"</"+l+"></"+r+">";if(e.length>0){var c=ut(),s=c.before,u=c.after,f=c.value,p=g(l),d=g(r);s.match(RegExp("(<"+d+"(>| .*?>))?<"+p+"(>| .*?>)$"))&&u.match(RegExp("^<\\/"+p+">(<\\/"+d+">)?"))?(s=s.replace(RegExp("(<"+d+"(>| .*?>))?<"+p+"(>| .*?>)$"),""),u=u.replace(RegExp("^<\\/"+p+">(<\\/"+d+">)?"),""),dt.autoEncodeHTML&&(f=f.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">")),rt.value=s+f+u,st(s.length,s.length+f.length,ft)):(dt.autoEncodeHTML&&(f=f.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),rt.value=s+a+f+o+u,st(s.length+a.length,s.length+f.length+a.length,ft))}else yt(a,o,1,!0)}},paragraph:{title:$t.paragraph,click:function(){var e=ut().value,t=dt.P,n=t.split(" ")[0],l=g(n);e.length>0?RegExp("^<"+l+"(>| .*?>)|<\\/"+l+">$").test(e)?ct(RegExp("<"+l+"(>| .*?>)([\\s\\S]*?)<\\/"+l+">","g"),"$2"):(ct(/^/,"<"+t+">",lt),ct(/$/,"</"+n+">",lt),ct(/\n/g,"</"+n+">\n<"+t+">",lt),ct(RegExp("<"+n+"(>| .*?>)<\\/"+n+">","g"),"",lt),ct(RegExp("(<"+n+"(>| .*?>))+","g"),"$1",lt),ct(RegExp("(<\\/"+n+">)+","g"),"$1")):yt("<"+t+">","</"+n+">")}},"quote-right":{title:$t.quote,click:function(){var e=ut(),t=dt.QUOTE,n=dt.BLOCKQUOTE;0===e.start||e.before.match(/\n$/)?yt("<"+n+">","</"+n.split(" ")[0]+">",1,!0):e.before.match(RegExp("<"+n.split(" ")[0]+"(>| .*?>)$"))?yt("<"+n+">","</"+n.split(" ")[0]+">",1,!0):yt("<"+t+">","</"+t.split(" ")[0]+">",1,!0)}},header:{title:$t.heading,click:function(){var e,t,n,l=ut(),r=dt.H_,i=r.split(" ")[0],a=g(i).replace(/%d/g,"[1-6]"),o=dt.P,c=o.split(" ")[0],s=g(c),u="<\\/?(?:"+a+"|"+s+")(>| .*?>)",h=d(l.before.replace(RegExp(u+"$"),"")).length>0?"\n\n":"",m=d(l.before.replace(RegExp(u+"$","g"),"")),v=f(l.value.replace(RegExp("^"+u+"|"+u+"$","g"),"").replace(/\n+/g," ")),b=p(l.after.replace(RegExp("^"+u,"g"),"")),x=l.value.match(RegExp("^"+u))?RegExp("^"+u).exec(l.value):RegExp(u+"$").exec(l.before);if(x=x?x[1]:">",Lt=6>Lt?Lt+1:0,l.value.length>0)l.before.match(RegExp(u+"$"))?(n=i.replace(/%d/g,Lt),rt.value=m+h+"<"+(Lt>0?n:c)+x+v+"</"+(Lt>0?n:c)+">\n\n"+b,e=m.length+h.length+1+(Lt>0?n.length:c.length)+x.length):(t=r.replace(/%d/g,Lt),n=i.replace(/%d/g,Lt),rt.value=m+h+"<"+(Lt>0?t:o)+x+v+"</"+(Lt>0?n:c)+">\n\n"+b,e=m.length+h.length+1+(Lt>0?t.length:o.length)+x.length),st(e,e+v.length,ft);else{var C=dt.placeholders.heading_text;r=r.replace(/%d/g,1),i=i.replace(/%d/g,1),Lt=1,rt.value=d(l.before)+h+"<"+r+">"+C+"</"+i+">\n\n"+p(l.after),e=d(l.before).length+h.length+1+r.length+1,st(e,e+C.length,ft)}}},link:{title:$t.link,click:function(){var e,t,n=ut(),l=dt.A,r=l.split(" ")[0],i=dt.placeholders.link_text;W.prompt(dt.prompts.link_url_title,dt.prompts.link_url,!0,function(a){t=a,W.prompt(dt.prompts.link_title_title,dt.prompts.link_title,!1,function(a){e=a,pt("<"+l+' href="'+t+'"'+(""!==e?' title="'+e+'"':"")+">","</"+r+">",0===n.value.length?function(){ct(/^/,i)}:1)})})}},image:{title:$t.image,click:function(){W.prompt(dt.prompts.image_url_title,dt.prompts.image_url,!0,function(e){var t=ut(),n=d(t.before),l=p(t.after),r=n.length>0?"\n\n":"",i=dt.emptyElementSuffix,a=decodeURIComponent(e.substring(e.lastIndexOf("/")+1,e.lastIndexOf(".")).replace(/[-+._]+/g," ")).toLowerCase().replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()});a=-1===a.indexOf("/")&&-1!==e.indexOf(".")?a:dt.placeholders.image_alt,rt.value=n+r+"<"+dt.IMG+' alt="'+a+'" src="'+e+'"'+i+"\n\n"+l,st(n.length+r.length+1+dt.IMG.length+6+a.length+7+e.length+1+i.length+2,ft)})}},"list-ol":{title:$t.ol,click:function(){m(dt.OL,dt.placeholders.list_ol_text)}},"list-ul":{title:$t.ul,click:function(){m(dt.UL,dt.placeholders.list_ul_text)}},superscript:{title:$t.superscript,click:function(){var e=dt.SUP;yt("<"+e+">","</"+e.split(" ")[0]+">",1,!0)}},subscript:{title:$t.subscript,click:function(){var e=dt.SUB;yt("<"+e+">","</"+e.split(" ")[0]+">",1,!0)}},"ellipsis-h":{title:$t.rule,click:function(){var e=ut(),t=d(e.before),n=p(e.after),l=t.length>0?"\n\n":"",r=dt.HR,i=dt.emptyElementSuffix;rt.value=t+l+"<"+r+i+"\n\n"+n,st(t.length+l.length+1+r.length+i.length+2,ft)}},undo:{title:$t.undo,click:Q.undo},repeat:{title:$t.redo,click:Q.redo}};for(var Rt in Ot)W.button(Rt,Ot[Rt])}o(rt,"focus",W.close),o(rt,"copy",function(){var e=ut();F.setTimeout(function(){dt.copy(e)},1)}),o(rt,"cut",function(){var e=ut();F.setTimeout(function(){e.end=e.start,dt.cut(e),ft()},1)}),o(rt,"paste",function(){var e=ut();F.setTimeout(function(){e.end=ut().end,e.value=rt.value.substring(e.start,e.end),dt.paste(e),ft()},1)}),o(rt,"keydown",function(e){var t=ut(),n=t.before,l=t.value,r=t.after,i=t.start,a=t.end,o=e.keyCode,c=e.ctrlKey,s=e.shiftKey,f=e.altKey,p=9==o;F.setTimeout(function(){dt.keydown(e,W)},1);var d=n,h=r[0],m="\\"==d.slice(-1);if(-1!==d.indexOf("(")&&s&&48==o&&")"==h&&!m||-1!==d.indexOf("{")&&s&&221==o&&"}"==h&&!m||-1!==d.indexOf("[")&&221==o&&"]"==h&&!m||-1!==d.indexOf('"')&&s&&222==o&&'"'==h&&!m||-1!==d.indexOf("'")&&!s&&222==o&&"'"==h&&!m||-1!==d.indexOf("`")&&!s&&192==o&&"`"==h&&!m||-1!==d.indexOf("<")&&s&&190==o&&">"==h&&!m)return st(a+1),!1;if(s&&57==o&&!m)return u("("+l+")",t);if(s&&219==o&&!m)return u("{"+l+"}",t);if(!s&&219==o&&!m)return u("["+l+"]",t);if(s&&222==o&&!m)return u('"'+l+'"',t);if(!s&&222==o&&!m)return u("'"+l+"'",t);if(!s&&192==o&&!m)return u("`"+l+"`",t);if(s&&188==o&&!m)return u("<"+l+">",t);if(s&&p)return ot(dt.tabSize),!1;if(p){if(n.match(/<[^\/>]*?$/)&&">"==r[0]){var G=/<([^\/>]*?)$/.exec(n);return rt.value=n+" "+l+"></"+G[1].split(" ")[0]+r,st(i+1,ft),!1}return it(dt.tabSize),!1}if(c&&90==o)return Q.undo(),!1;if(c&&89==o||c&&82==o)return Q.redo(),!1;if(dt.shortcut){if(c&&66==o)return Ot.bold.click(),!1;if(c&&73==o)return Ot.italic.click(),!1;if(c&&81==o)return Ot["quote-right"].click(),!1;if(c&&72==o)return Ot.header.click(),!1;if(c&&76==o)return Ot.link.click(),!1;if(c&&71==o)return Ot.image.click(),!1}if(13==o){if(f&&0===l.length)return at(V),!1;if(c)return Ot.paragraph.click(),!1;if(s)return at("<"+dt.BR+dt.emptyElementSuffix+"\n"),W.scroll(),!1;var j=dt.LI.split(" ")[0];if(n.match(RegExp("<\\/"+vt+">$"))){var G=RegExp("(?:^|\\n)([\\t ]*)<"+vt+"(>| .*?>).*?<\\/"+vt+">$").exec(n);return at("\n"+G[1]+"<"+j+G[2]+"</"+j+">",function(){st(a+G[1].length+G[2].length+4,ft)}),W.scroll(),!1}if(r.match(RegExp("^<\\/"+vt+">"))&&">"!=n.slice(-1)){var G=RegExp("(?:^|\\n)([\\t ]*)<"+vt+"(>| .*?>).*$").exec(n);return at("</"+j+">\n"+G[1]+"<"+j+G[2]),W.scroll(),!1}var X=dt.P.split(" ")[0];if(r.match(RegExp("^<\\/"+mt+">"))){var G=RegExp("(?:^|\\n?)([\\t ]*)<"+mt+"(>| .*?>).*$").exec(n);return at("</"+X+">\n"+G[1]+"<"+X+G[2]),W.scroll(),!1}var J=RegExp("(?:^|\\n)(("+ht+")+)(.*?)$").exec(n),Z=J?J[1]:"";return n.match(/[\(\{\[]$/)&&r.match(/^[\]\}\)]/)||n.match(/<[^\/>]*?>$/)&&r.match(/^<\//)?(at("\n"+Z+dt.tabSize+"\n"+Z,function(){st(i+Z.length+dt.tabSize.length+1,ft)}),W.scroll(),!1):(at("\n"+Z),W.scroll(),!1)}var et={"'":b,'"':C,"---":E,"--":k,"...":T,"|":y,"(c)":L,"(C)":L,"(p)":$,"(P)":$,"(sm)":O,"(SM)":O," sm":O," SM":O,"(tm)":R,"(TM)":R," tm":R," TM":R,"(r)":_,"(R)":_,"+-":H,"-+":H,x:S,"/":M,"^":I,"<<":U,">>":P,"<":w,">":N,"<=":B,">=":A,"!=":z};if(l.length>0){if(f){ct(/'([^']*?)'/g,v+"$1"+b,lt),ct(/"([^"]*?)"/g,x+"$1"+C,lt);for(var tt in et)ct(RegExp(g(tt),"g"),et[tt],lt);return ft(),!1}}else{if(f){if(-1!==n.indexOf('"')&&'"'==r[0])return rt.value=n.replace(/"([^"]*?)$/,x+"$1")+C+r.slice(1),st(a,ft),!1;if(-1!==n.indexOf("'")&&"'"==r[0])return rt.value=n.replace(/'([^']*?)$/,v+"$1")+b+r.slice(1),st(a,ft),!1;if(n.slice(-2).match(/\w'$/i))return rt.value=n.slice(0,-1)+b+r,st(a,ft),!1;if(n.match(/\((c|p|sm|tm|r)$/i)&&")"==r[0]){var nt=n.match(/\((sm|tm)$/i)?2:1;return rt.value=n.slice(0,-(nt+1))+et["("+n.slice(-nt).toLowerCase()+")"]+r.slice(1),st(a-nt,ft),!1}var pt=n.replace(/&lt;/g,"<").replace(/&gt;/g,">"),gt=r.replace(/&lt;/g,"<").replace(/&gt;/g,">");if(-1!==pt.indexOf("<<")&&0===gt.indexOf(">>"))return rt.value=n.replace(/(?:<<|&lt;&lt;)([^<]*)$/,U+"$1")+r.replace(/^(?:>>|&gt;&gt;)/,P),st(pt.length-1,ft),!1;if(-1!==pt.indexOf("<")&&0===gt.indexOf(">"))return rt.value=n.replace(/(?:<|&lt;)([^<]*)$/,w+"$1")+r.replace(/^(?:>|&gt;)/,N),st(pt.length,ft),!1;for(var tt in et)if(n.slice(-tt.length)==tt)return rt.value=n.slice(0,-tt.length)+et[tt]+r,st(i-tt.length+1,ft),!1;if(37==o)return at(K),!1;if(38==o)return at(Y),!1;if(39==o)return at(D),!1;if(40==o)return at(q),!1}if(8==o){if(n.match(RegExp(ht+"$")))return ot(dt.tabSize),!1;if(n.match(/<\/?[^>]*?>$/))return ot("</?[^>]*?>",1,!0),!1;switch(n.slice(-1)){case"(":return yt("(",")"),!1;case"{":return yt("{","}"),!1;case"[":return yt("[","]"),!1;case'"':return yt('"','"'),!1;case"'":return yt("'","'"),!1;case"<":return yt("<",">"),!1;case x:return yt(x,C),!1;case v:return yt(v,b),!1;case U:return yt(U,P),!1;case w:return yt(w,N),!1}}}return 39==o&&r.match(/^<\/.*?>/)?(st(a+r.indexOf(">")+1),!1):27==o?(Tt.focus(),!1):void(f||c||s||F.setTimeout(ft,1))});var _t=RegExp("(^| )"+dt.areaClass+"( |$)"),Ht=rt.className;Ht.match(_t)||(rt.className=f(Ht+" "+dt.areaClass)),dt.ready(W),W.grip=Q,W.grip.config=dt};