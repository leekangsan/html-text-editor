/*!
 * ----------------------------------------------------------
 *  HTML TEXT EDITOR PLUGIN 1.4.3
 * ----------------------------------------------------------
 * Author: Taufik Nurrohman <http://latitudu.com>
 * Licensed under the MIT license.
 *
 * REQUIRES:
 * ==========================================================
 * [1]. https://github.com/tovic/simple-text-editor-library
 * [2]. https://fortawesome.github.io/Font-Awesome/icons
 * ==========================================================
 * ----------------------------------------------------------
 *
 */

var HTE=function(e,t){function n(e){return void 0!==e}function r(e){return"string"==typeof e}function l(e){return"number"==typeof e}function i(e){return"function"==typeof e}function o(e){return"object"==typeof e}function a(e,t,n){return t="on"+t,null===n?e[t]=null:(i(e[t])&&(n=function(e,t){return function(){return e.apply(this,arguments),t.apply(this,arguments)}}(e[t],n)),void(e[t]=n))}function c(e,t){e=e||{};for(var n in t)e[n]=o(t[n])?c(e[n],t[n]):t[n];return e}function u(e,t){var n=t.replace(/\-(\w)/g,function(e,t){return t.toUpperCase()}),r=0;return r=G.defaultView&&G.defaultView.getComputedStyle?G.defaultView.getComputedStyle(e,null).getPropertyValue(t):e.style[n]}function s(e,t){return gt(e,function(){vt(t.end+1,xt)}),!1}function f(e){return e.replace(/^\s+|\s+$/g,"")}function p(e){return e.replace(/^\s+/,"")}function d(e){return e.replace(/\s+$/,"")}function g(e){return e.replace(X.escape,"\\$1")}function h(e){return e.parentNode}function m(e,t){var n,r=bt(),l=e,i=Ct.LI,o=l.split(" ")[0],a=i.split(" ")[0];if(r.value.length){var c=/([\s\S]*?)<(?:ol|ul)(>| .*?>)([\s\S]*?)<\/(?:ol|ul)>([\s\S]*?)/g;r.value==t?vt():r.value.match(c)?mt(c,"$1<"+o+"$2$3</"+o+">$4"):Ot("\n\n",function(){gt("<"+l+">\n"+Ct.tabSize+"<"+i+">"+r.value.replace(/\n/g,"</"+a+">\n"+Ct.tabSize+"<"+i+">").replace(RegExp("\\n("+Ct.tabSize+")?<"+i+"><\\/"+a+">\\n","g"),"\n</"+o+">\n\n<"+l+">\n")+"</"+a+">\n</"+o+">")},"\n\n",!0)}else if(r.after.match(RegExp("^<\\/"+a+">"))){var u=/(?:^|\n)([\t ]*).*?$/.exec(r.before),s=u?u[1]:"";gt("\n"+s+Ct.tabSize+"<"+l+">\n"+s+Ct.tabSize+Ct.tabSize+"<"+i+">"+t+"</"+a+">\n"+s+Ct.tabSize+"</"+o+">\n"+s,function(){n=bt().end-s.length-1-1-o.length-2-Ct.tabSize.length-s.length-1-1-a.length-2,vt(n-t.length,n,xt)})}else r.before.match(/<\/(?:ol|ul)>\s?$/)?(pt.value=r.before.replace(/<(?:ol|ul)(>| .*?>)([\s\S]*?)<\/(?:ol|ul)>(\s?)$/g,"<"+o+"$1$2</"+o+">$3")+r.after,vt(r.end,xt)):Ot("\n\n",function(){gt("<"+l+">\n"+Ct.tabSize+"<"+i+">"+t+"</"+a+">\n</"+o+">",function(){r=bt();var e=r.end-4-o.length-3-a.length;vt(e-t.length,e,xt)})},"\n\n",!0)}var v="\u2018",b="\u2019",x="\u201C",k="\u201D",C="\u2013",$="\u2014",E="\u2026",y="\u00A6",T="\u00A9",L="\u2117",R="\u2120",H="\u2122",O="\u00AE",_="\u00B1",S="\u00D7",w="\u00F7",N="\u00B0",M="\u2039",B="\u203A",U="\u00AB",A="\u00BB",I="\u2264",z="\u2265",P="\u2260",K="\u2190",D="\u2192",q="\u2191",Y="\u2193",Q="\u21B5",F="\u00B7",V=this,W=window,G=document,X=new Editor(e),j=function(){},J={tabSize:"    ",toolbar:!0,shortcut:!1,areaClass:"editor-area",toolbarClass:"editor-toolbar",toolbarIconClass:"fa fa-%s",toolbarButtonClass:"editor-toolbar-button editor-toolbar-button-%s",toolbarSeparatorClass:"editor-toolbar-separator",toolbarPosition:"before",dropClass:"custom-drop custom-drop-%s",modalClass:"custom-modal custom-modal-%s",modalHeaderClass:"custom-modal-header custom-modal-%s-header",modalContentClass:"custom-modal-content custom-modal-%s-content",modalFooterClass:"custom-modal-action custom-modal-%s-action",modalOverlayClass:"custom-modal-overlay custom-modal-%s-overlay",emptyElementSuffix:">",autoEncodeHTML:!0,P:"p",BR:"br",H_:"h%d",STRONG:"strong",EM:"em",U:"u",STRIKE:'del datetime="%Y-%m-%d"',UL:"ul",OL:"ol",LI:"li",HR:"hr",QUOTE:"q",BLOCKQUOTE:"blockquote",CODE:"code",PRE:"pre",SUB:"sub",SUP:"sup",A:"a",IMG:"img",buttons:{ok:"OK",yes:"Yes",no:"No",cancel:"Cancel",open:"Open",close:"Close",bold:"Bold",italic:"Italic",underline:"Underline",strike:"Strike",superscript:"Superscript",subscript:"Subscript",code:"Code",paragraph:"Paragraph",quote:"Quote",heading:"H1 "+C+" H6",link:"Link",image:"Image",ol:"Ordered List",ul:"Unordered List",rule:"Horizontal Rule",undo:"Undo",redo:"Redo"},prompts:{link_title:"link title goes here"+E,link_title_title:"Link Title",link_url:"http://",link_url_title:"Link URL",image_url:"http://",image_url_title:"Image URL"},placeholders:{text:"text goes here"+E,heading_text:"Heading",link_text:"link text",list_ul_text:"List item",list_ol_text:"List item",image_alt:"Image"},update:j,keydown:j,click:j,ready:j,copy:j,cut:j,paste:j},Z=G.body,et=G.createElement("div"),tt=G.createElement("div"),nt=G.createElement("div"),rt=0,lt=null,it=null,ot=0,at=0,ct=0,ut=0,st=Z.parentNode.offsetWidth,ft=W.innerHeight>Z.parentNode.offsetHeight?W.innerHeight:Z.parentNode.offsetHeight,pt=e,dt=X.indent,gt=X.insert,ht=X.outdent,mt=X.replace,vt=X.select,bt=X.selection,xt=X.updateHistory,kt=X.wrap,Ct=c(J,t),$t=G.createElement("span");V.DOM={overlay:et,modal:tt,drop:nt};var Et=g(Ct.tabSize),yt=g(Ct.P.split(" ")[0]),Tt=g(Ct.LI.split(" ")[0]);V.shortcuts=[],V.shortcut=function(e,t){V.shortcuts[e.toLowerCase()]=t},V.event=function(e,t,n){return a(t,e,n)},V.modal=function(e,t,n){i(e)&&(n=t,t=e,e="default"),e=e||"default",n=n||{},rt=Z.scrollTop||Z.parentNode.scrollTop,et.className=Ct.modalOverlayClass.replace(/%s/g,e),tt.className=Ct.modalClass.replace(/%s/g,e),tt.innerHTML='<div class="'+Ct.modalHeaderClass.replace(/%s/g,e)+'"></div><div class="'+Ct.modalContentClass.replace(/%s/g,e)+'"></div><div class="'+Ct.modalFooterClass.replace(/%s/g,e)+'"></div>';var r=tt.style,l="left"in n,o="top"in n;r.visibility="hidden",Z.appendChild(et),Z.appendChild(tt),W.setTimeout(function(){var e=tt.offsetWidth,t=tt.offsetHeight;r.position="absolute",r.left=l?n.left+"px":"50%",r.top=o?n.top+"px":"50%",r.zIndex="9999",r.marginLeft=(l?0:0-e/2)+"px",r.marginTop=(o?0:rt-t/2)+"px",r.visibility="",tt.offsetLeft<0&&!l&&(r.left=0,r.marginLeft=0,l=!0,n.left=0),tt.offsetTop<0&&!o&&(r.top=0,r.marginTop=0,o=!0,n.top=0);var i=tt.children[0];a(i,"mousedown",function(){return it=tt,ct=ot-it.offsetLeft,ut=at-it.offsetTop,!1}),a(Z,"mousemove",null),a(Z,"mousemove",function(n){ot=n.pageX,at=n.pageY+rt;var i,a,c=l?0:e/2,u=o?0:t/2;if(null!==it){var s=l?e:0,f=o?t:0;i=ot-ct+c,a=at-ut+u,c>i&&(i=c),u>a&&(a=u),i+c+s>st&&(i=st-c-s),a+u+f>ft&&(a=ft-u-f),r.left=i+"px",r.top=a-rt+"px"}})},10),i(t)&&t(et,tt)},V.drop=function(e,t,n){i(e)&&(n=t,t=e,e="default"),!n&&lt&&(n={left:lt.offsetLeft,top:lt.offsetTop+lt.offsetHeight}),e=e||"default",n=n||{},rt=Z.scrollTop||Z.parentNode.scrollTop,nt.className=Ct.dropClass.replace(/%s/g,e);var r=nt.style,l="left"in n,o="top"in n;r.visibility="hidden",Z.appendChild(nt),W.setTimeout(function(){var e=nt.offsetWidth,t=nt.offsetHeight;r.position="absolute",r.left=l?n.left+"px":"50%",r.top=o?n.top+"px":"50%",r.zIndex="9999",r.marginLeft=(l?0:0-e/2)+"px",r.marginTop=(o?0:rt-t/2)+"px",r.visibility="",n.left+e>st&&(r.left=st-e+"px",r.marginLeft=0),n.top+t>ft&&(r.top=ft-t+"px",r.marginTop=0)},10),i(t)&&t(nt)},V.prompt=function(e,t,n,r,l){V.modal("prompt",function(l,o){var c=function(e){i(r)?(V.close(),r(e)):V.close(!0)},u=G.createElement("input");u.type="text",u.value=t,a(u,"keydown",function(e){var r=e.keyCode;if(27==r)return V.close(!0),!1;if(40==r)return s.focus(),!1;if(n){if(13==r&&""!==this.value&&this.value!==t)return c(this.value),!1}else if(13==r)return c(this.value==t?"":this.value),!1});var s=G.createElement("button");s.innerHTML=Ct.buttons.ok,a(s,"click",function(){return n?""!==u.value&&u.value!==t&&c(u.value):c(u.value==t?"":u.value),!1});var f=G.createElement("button");f.innerHTML=Ct.buttons.cancel,a(f,"click",function(){return V.close(!0),!1}),a(s,"keydown",function(e){var t=e.keyCode;return 27==t?(V.close(!0),!1):38==t?(u.focus(),!1):39==t||40==t?(f.focus(),!1):void 0}),a(f,"keydown",function(e){var t=e.keyCode;return 27==t?(V.close(!0),!1):37==t||38==t?(s.focus(),!1):40==t?!1:void 0}),o.children[0].innerHTML=e?e:"",o.children[1].appendChild(u),o.children[2].appendChild(s),o.children[2].appendChild(G.createTextNode(" ")),o.children[2].appendChild(f),W.setTimeout(function(){u.select()},10)},l)},V.alert=function(e,t,n,r){V.modal("alert",function(r,l){var o=G.createElement("button");o.innerHTML=Ct.buttons.ok,a(o,"click",function(){return i(n)?(V.close(),n()):V.close(!0),!1}),a(o,"keydown",function(e){return 27==e.keyCode?(V.close(!0),!1):void 0}),l.children[0].innerHTML=e?e:"",l.children[1].innerHTML=t?t:"",l.children[2].appendChild(o),W.setTimeout(function(){o.focus()},10)},r)},V.confirm=function(e,t,r,l){V.modal("confirm",function(l,o){var c=G.createElement("button");c.innerHTML=Ct.buttons.ok,a(c,"click",function(){return n(r)&&i(r.OK)?(V.close(),r.OK()):V.close(!0),!1});var u=G.createElement("button");u.innerHTML=Ct.buttons.cancel,a(u,"click",function(){return n(r)&&i(r.CANCEL)?(V.close(),r.CANCEL()):V.close(!0),!1}),a(c,"keydown",function(e){var t=e.keyCode;return 27==t?(V.close(!0),!1):39==t||40==t?(u.focus(),!1):void 0}),a(u,"keydown",function(e){var t=e.keyCode;return 27==t?(V.close(!0),!1):37==t||38==t?(c.focus(),!1):40==t?!1:void 0}),o.children[0].innerHTML=e?e:"",o.children[1].innerHTML=t?t:"",o.children[2].appendChild(c),o.children[2].appendChild(G.createTextNode(" ")),o.children[2].appendChild(u),W.setTimeout(function(){u.focus()},10)},l)},V.close=function(e){if(lt=null,it=null,h(et)&&Z.removeChild(et),h(tt)&&Z.removeChild(tt),h(nt)&&Z.removeChild(nt),e&&e!==!1){var t=bt();o(e)||(e={}),vt("start"in e?e.start:t.start,"end"in e?e.end:t.end)}},a(W,"resize",function(){st=Z.parentNode.offsetWidth,ft=W.innerHeight>Z.parentNode.offsetHeight?W.innerHeight:Z.parentNode.offsetHeight}),a(Z,"mouseup",function(){it=null}),a(et,"click",function(){V.close(!0)}),V.scroll=function(e,t){l(e)?pt.scrollTop=e:pt.scrollTop+=parseInt(u(pt,"line-height"),10),i(t)&&t()},V.time=function(e){var t=new Date,r=t.getFullYear(),l=t.getMonth()+1,i=t.getDate(),o=t.getHours(),a=t.getMinutes(),c=t.getSeconds(),u=t.getMilliseconds();10>l&&(l="0"+l),10>i&&(i="0"+i),10>o&&(o="0"+o),10>a&&(a="0"+a),10>c&&(c="0"+c),10>u&&(u="0"+u);var s={Y:""+r,m:""+l,d:""+i,H:""+o,i:""+a,s:""+c,u:""+u};return n(e)?s[e]:s},Ct.toolbar&&($t.className=Ct.toolbarClass,pt.parentNode.insertBefore($t,"before"==Ct.toolbarPosition?pt:null));var Lt=G.createElement("a");Lt.href="#esc:"+(new Date).getTime(),Lt.style.width=0,Lt.style.height=0,pt.parentNode.appendChild(Lt),V.button=function(e,t){if("|"===e)return V.separator(t);if(t=t||{},t.title!==!1){var n,c=G.createElement("a");if(c.className=Ct.toolbarButtonClass.replace(/%s/g,e),c.setAttribute("tabindex",-1),c.href="#"+e.replace(" ",":").replace(/[^a-z0-9\:]/gi,"-").replace(/-+/g,"-").replace(/^-|-$/g,""),c.innerHTML=t.text?t.text.replace(/%s/g,e):'<i class="'+Ct.toolbarIconClass.replace(/%s/g,e)+'"></i>',t.title&&(c.title=t.title),o(t.attr))for(var u in t.attr)if(r(t.attr[u])&&"+="==t.attr[u].slice(0,2)){var s=c.getAttribute(u)||"";c.setAttribute(u,s+t.attr[u].slice(2))}else c.setAttribute(u,t.attr[u]);a(c,"click",function(e){if(i(t.click)){var n=this.hash.replace("#","");return V.close(),lt=c,t.click(e,V),Ct.click(e,V,n),Ct.update(e,V,n),!1}}),a(c,"keydown",function(e){return 27==e.keyCode?(V.close(!0),!1):void 0}),l(t.position)?(n=t.position<0?t.position+$t.children.length+1:t.position-1,$t.insertBefore(c,$t.children[n]||null)):$t.appendChild(c),J.buttons[e]=t}},V.separator=function(e){e=e||{};var t,n=G.createElement("span");if(n.className=Ct.toolbarSeparatorClass,o(e.attr))for(var i in e.attr)if(r(e.attr[i])&&"+="==e.attr[i].slice(0,2)){var a=n.getAttribute(i)||"";n.setAttribute(i,a+e.attr[i].slice(2))}else n.setAttribute(i,e.attr[i]);l(e.position)?(t=e.position<0?e.position+$t.children.length+1:e.position-1,$t.insertBefore(n,$t.children[t]||null)):$t.appendChild(n)},X.tidy=function(e,t,r,l){r=n(r)?r:e;var o,a=bt(),c=-1===e.indexOf("\n")&&a.before.match(/\n$/),u=-1===r.indexOf("\n")&&a.after.match(/^\n/),s=c?a.before:d(a.before),g=f(a.value),h=u?a.after:p(a.after),m=s.length&&!c?e:"",v=h.length&&!u?r:"";return a.value.length&&!l&&i(t)?t(a):(pt.value=s+m+g+v+h,o=s.length+m.length,vt(o,o+g.length),void(i(t)&&t(bt())))},X.toggle=function(e,t,n,r){var l=bt();if(l.before.slice(-e.length)!=e&&l.after.slice(0,t.length)!=t)kt(e,t,!l.value.length&&r?function(){mt(/^/,r===!0?Ct.placeholders.text:r)}:1);else{var o=l.before.slice(-e.length)==e?l.before.slice(0,-e.length):l.before,a=l.after.slice(0,t.length)==t?l.after.slice(t.length):l.after;pt.value=o+l.value+a,vt(o.length,o.length+l.value.length,xt)}i(n)&&n()};var Rt=0,Ht=Ct.buttons,Ot=X.tidy,_t=X.toggle,St={bold:{title:Ht.bold,click:function(){var e=Ct.STRONG;Ot(" ",function(){_t("<"+e+">","</"+e.split(" ")[0]+">",1,!0)})}},italic:{title:Ht.italic,click:function(){var e=Ct.EM;Ot(" ",function(){_t("<"+e+">","</"+e.split(" ")[0]+">",1,!0)})}},underline:{title:Ht.underline,click:function(){var e=Ct.U;Ot(" ",function(){_t("<"+e+">","</"+e.split(" ")[0]+">",1,!0)})}},strikethrough:{title:Ht.strike,click:function(){var e=V.time(),t=Ct.STRIKE;t=t.replace(/%Y/g,e.Y).replace(/%m/g,e.m).replace(/%d/g,e.d).replace(/%H/g,e.H).replace(/%i/g,e.i).replace(/%s/g,e.s).replace(/%u/g,e.u),Ot(" ",function(){_t("<"+t+">","</"+t.split(" ")[0]+">",1,!0)})}},paragraph:{title:Ht.paragraph,click:function(){var e=bt(),t=Ct.P,n=t.split(" ")[0],r=g(n),l=Ct.placeholders.text;if(e.value.length)e.value==l?vt():RegExp("^<"+r+"(>| .*?>)|<\\/"+r+">$").test(e.value)?mt(RegExp("<"+r+"(>| .*?>)([\\s\\S]*?)<\\/"+r+">","g"),"$2"):(mt(/^/,"<"+t+">",j),mt(/$/,"</"+n+">",j),mt(/\n/g,"</"+n+">\n<"+t+">",j),mt(RegExp("<"+n+"(>| .*?>)<\\/"+n+">","g"),"",j),mt(RegExp("(<"+n+"(>| .*?>))+","g"),"$1",j),mt(RegExp("(<\\/"+n+">)+","g"),"$1"));else if(e.after.match(RegExp("^<\\/"+n+">")))kt("</"+n+">\n<"+t+">","",function(){mt(/^/,l)},!0);else{var i=!e.before.match(RegExp("<\\/"+n+">\\s*$")),o=!e.after.match(RegExp("^\\s*<"+n+"(>| .*?>)"));Ot(i?"\n\n":"\n",function(){_t("<"+t+">","</"+n+">",1,!0)},o?"\n\n":"\n",!0)}}},"quote-right":{title:Ht.quote,click:function(){var e=bt(),t=Ct.QUOTE,n=Ct.BLOCKQUOTE;e.before.match(/(^|\n)$/)?Ot("\n\n",function(){_t("<"+n+">","</"+n.split(" ")[0]+">",1,!0)},"\n\n",!0):Ot(" ",function(){t=e.before.match(RegExp("<"+n.split(" ")[0]+"(>| .*?>)$"))?n:t,_t("<"+t+">","</"+t.split(" ")[0]+">",1,!0)})}},code:{title:Ht.code,click:function(){var e=bt(),t=Ct.CODE,n=Ct.PRE,r=t.split(" ")[0],l=n.split(" ")[0],i=!e.before.match(/(^|\n)$/),o=i?" ":"\n\n",a=i?"<"+t+">":"<"+n+"><"+t+">",c=i?"</"+r+">":"</"+r+"></"+l+">";if(Ot(o,j,o,!i),e.value.length){var e=bt(),u=e.before,s=e.value,f=e.after,p=g(r),d=g(l);u.match(RegExp("(<"+d+"(>| .*?>))?<"+p+"(>| .*?>)s*$"))&&f.match(RegExp("^s*<\\/"+p+">(<\\/"+d+">)?"))?(u=u.replace(RegExp("(<"+d+"(>| .*?>))?<"+p+"(>| .*?>)$"),""),f=f.replace(RegExp("^<\\/"+p+">(<\\/"+d+">)?"),""),Ct.autoEncodeHTML&&(s=s.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">")),pt.value=u+s+f,vt(u.length,u.length+s.length,xt)):(Ct.autoEncodeHTML&&(s=s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),pt.value=u+a+s+c+f,vt(u.length+a.length,u.length+s.length+a.length,xt))}else _t(a,c,1,!0)}},header:{title:Ht.heading,click:function(){var e,t,n,r=bt(),l=Ct.H_,i=l.split(" ")[0],o=g(i).replace(/%d/g,"[1-6]"),a=Ct.P,c=a.split(" ")[0],u=g(c),s="<\\/?(?:"+o+"|"+u+")(>| .*?>)",h=d(r.before.replace(RegExp(s+"$"),"")),m=f(r.value.replace(RegExp("^"+s+"|"+s+"$","g"),"").replace(/\n+/g," ")),v=p(r.after.replace(RegExp("^"+s),"")),b=h.length?"\n\n":"",x=v.length?"\n\n":"",k=r.value.match(RegExp("^"+s))?RegExp("^"+s).exec(r.value):RegExp(s+"$").exec(r.before);if(k=k?k[1]:">",Rt=6>Rt?Rt+1:0,r.value.length)r.before.match(RegExp(s+"$"))?(n=i.replace(/%d/g,Rt),pt.value=h+b+"<"+(Rt>0?n:c)+k+m+"</"+(Rt>0?n:c)+">"+x+v,e=h.length+b.length+1+(Rt>0?n.length:c.length)+k.length):(t=l.replace(/%d/g,Rt),n=i.replace(/%d/g,Rt),pt.value=h+b+"<"+(Rt>0?t:a)+k+m+"</"+(Rt>0?n:c)+">"+x+v,e=h.length+b.length+1+(Rt>0?t.length:a.length)+k.length),vt(e,e+m.length,xt);else{var C=Ct.placeholders.heading_text;l=l.replace(/%d/g,1),i=i.replace(/%d/g,1),Rt=1,pt.value=d(r.before)+b+"<"+l+">"+C+"</"+i+">"+x+v,e=d(r.before).length+b.length+1+l.length+1,vt(e,e+C.length,xt)}}},link:{title:Ht.link,click:function(e){var t,n,r=bt(),l=Ct.A,i=l.split(" ")[0],o=Ct.placeholders.link_text;V.prompt(Ct.prompts.link_url_title,Ct.prompts.link_url,!0,function(a){n=a,V.prompt(Ct.prompts.link_title_title,Ct.prompts.link_title,!1,function(a){Ot(" ",function(){t=a.replace(/'/g,"&apos;").replace(/"/g,"&quot;"),kt("<"+l+' href="'+n+'"'+(""!==t?' title="'+t+'"':"")+">","</"+i+">",r.value.length?1:function(){mt(/^/,o)})}),Ct.update(e,V)})})}},image:{title:Ht.image,click:function(e){V.prompt(Ct.prompts.image_url_title,Ct.prompts.image_url,!0,function(t){Ot("\n\n",function(){var e=bt(),n=f(e.value.length?e.value:decodeURIComponent(t.split("/").pop().replace(/\..*$/,"").replace(/[-+._]+/g," ")).toLowerCase().replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()}));n.length||(n=Ct.placeholders.image_alt),gt("<"+Ct.IMG+' alt="'+n+'" src="'+t+'"'+Ct.emptyElementSuffix,function(){e=bt(),e.after.length||(pt.value+="\n\n"),vt(e.end+2,xt)})},"\n\n",!0),Ct.update(e,V)})}},"list-ol":{title:Ht.ol,click:function(){m(Ct.OL,Ct.placeholders.list_ol_text)}},"list-ul":{title:Ht.ul,click:function(){m(Ct.UL,Ct.placeholders.list_ul_text)}},superscript:{title:Ht.superscript,click:function(){var e=Ct.SUP;Ot(" ",function(){_t("<"+e+">","</"+e.split(" ")[0]+">",1,!0)})}},subscript:{title:Ht.subscript,click:function(){var e=Ct.SUB;Ot(" ",function(){_t("<"+e+">","</"+e.split(" ")[0]+">",1,!0)})}},"ellipsis-h":{title:Ht.rule,click:function(){Ot("\n\n",function(){gt("<"+Ct.HR+Ct.emptyElementSuffix,function(){var e=bt();e.after.length||(pt.value+="\n\n"),vt(e.end+2,xt)})})}},undo:{title:Ht.undo,click:X.undo},repeat:{title:Ht.redo,click:X.redo}};for(var wt in St)V.button(wt,St[wt]);a(pt,"focus",V.close),a(pt,"copy",function(e){var t=bt();W.setTimeout(function(){Ct.copy(t),Ct.update(e,V)},1)}),a(pt,"cut",function(e){var t=bt();W.setTimeout(function(){t.end=t.start,Ct.cut(t),Ct.update(e,V),xt()},1)}),a(pt,"paste",function(e){var t=bt();W.setTimeout(function(){t.end=bt().end,t.value=pt.value.substring(t.start,t.end),Ct.paste(t),Ct.update(e,V),xt()},1)}),a(pt,"keydown",function(e){var t=bt(),n=t.before,r=t.value,l=t.after,i=t.start,o=t.end,a=e.keyCode,c=e.ctrlKey,u=e.shiftKey,f=e.altKey,p=9==a;W.setTimeout(function(){Ct.keydown(e,V),Ct.update(e,V)},1);for(var d in V.shortcuts){var h=d.split("+"),m=0;for(var G in h)("ctrl"==h[G]&&c||"shift"==h[G]&&u||"alt"==h[G]&&f||"tab"==h[G]&&p||parseInt(h[G],10)==a)&&m++;if(m===h.length)return V.shortcuts[d](e,V)}var J=n,Z=l[0],et="\\"==J.slice(-1);if(-1!==J.indexOf("(")&&u&&48==a&&")"==Z&&!et||-1!==J.indexOf("{")&&u&&221==a&&"}"==Z&&!et||-1!==J.indexOf("[")&&221==a&&"]"==Z&&!et||-1!==J.indexOf('"')&&u&&222==a&&'"'==Z&&!et||-1!==J.indexOf("'")&&!u&&222==a&&"'"==Z&&!et||-1!==J.indexOf("`")&&!u&&192==a&&"`"==Z&&!et||-1!==J.indexOf("<")&&u&&190==a&&">"==Z&&!et)return vt(o+1),!1;if(u&&57==a&&!et)return s("("+r+")",t);if(u&&219==a&&!et)return s("{"+r+"}",t);if(!u&&219==a&&!et)return s("["+r+"]",t);if(u&&222==a&&!et)return s('"'+r+'"',t);if(!u&&222==a&&!et&&!n.match(/\w$/))return s("'"+r+"'",t);if(!u&&192==a&&!et&&!n.match(/\w$/))return s("`"+r+"`",t);if(u&&188==a&&!et)return s("<"+r+">",t);if(u&&p)return ht(Ct.tabSize),!1;if(p){if(n.match(/<[^\/>]*?$/)&&">"==l[0]){var tt=/<([^\/>]*?)$/.exec(n);return pt.value=n+" "+r+"></"+tt[1].split(" ")[0]+l,vt(i+1,xt),!1}return dt(Ct.tabSize),!1}if(c&&90==a)return X.undo(),!1;if(c&&89==a)return X.redo(),!1;if(Ct.shortcut){if(c&&66==a)return St.bold.click(),!1;if(c&&71==a)return St.image.click(),!1;if(c&&72==a)return St.header.click(),!1;if(c&&73==a)return St.italic.click(),!1;if(c&&!u&&75==a)return St.code.click(),!1;if(c&&76==a)return St.link.click(),!1;if(c&&81==a)return St["quote-right"].click(),!1;if(c&&82==a)return St["ellipsis-h"].click(),!1;if(c&&85==a)return St.underline.click(),!1;if(r.length&&46==a)return St.strikethrough.click(),!1;if(c&&61==a)return St["list-ol"].click(),!1;if(c&&173==a)return St["list-ul"].click(),!1;if(r.length&&c&&38==a)return St.superscript.click(),!1;if(r.length&&c&&40==a)return St.subscript.click(),!1}if(13==a){if(f&&0===r.length)return gt(Q),!1;if(c)return St.paragraph.click(),!1;if(u)return gt("<"+Ct.BR+Ct.emptyElementSuffix+"\n"),V.scroll(),!1;var nt=Ct.LI.split(" ")[0];if(n.match(RegExp("<\\/"+Tt+">$"))){var tt=RegExp("(?:^|\\n)([\\t ]*)<"+Tt+"(>| .*?>).*?<\\/"+Tt+">$").exec(n);return gt("\n"+tt[1]+"<"+nt+tt[2]+"</"+nt+">",function(){vt(o+tt[1].length+tt[2].length+4,xt)}),V.scroll(),!1}if(l.match(RegExp("^<\\/"+Tt+">"))&&">"!=n.slice(-1)){var tt=RegExp("(?:^|\\n)([\\t ]*)<"+Tt+"(>| .*?>).*$").exec(n);return gt("</"+nt+">\n"+tt[1]+"<"+nt+tt[2]),V.scroll(),!1}var rt=Ct.P.split(" ")[0];if(l.match(RegExp("^<\\/"+yt+">"))){var tt=RegExp("(?:^|\\n?)([\\t ]*)<"+yt+"(>| .*?>).*$").exec(n);return gt("</"+rt+">\n"+tt[1]+"<"+rt+tt[2]),V.scroll(),!1}var lt=RegExp("(?:^|\\n)(("+Et+")+)(.*?)$").exec(n),it=lt?lt[1]:"";return n.match(/[\(\{\[]$/)&&l.match(/^[\]\}\)]/)||n.match(/<[^\/>]*?>$/)&&l.match(/^<\//)?(gt("\n"+it+Ct.tabSize+"\n"+it,function(){vt(i+it.length+Ct.tabSize.length+1,xt)}),V.scroll(),!1):(gt("\n"+it),V.scroll(),!1)}var ot={"'":b,'"':k,"---":$,"--":C,"...":E,"|":y,"(c)":T,"(C)":T,"(p)":L,"(P)":L,"(sm)":R,"(SM)":R," sm":R," SM":R,"(tm)":H,"(TM)":H," tm":H," TM":H,"(r)":O,"(R)":O,"+-":_,"-+":_,x:S,"/":w,"^":N,"<<":U,">>":A,"<":M,">":B,"<=":I,">=":z,"!=":P,".":F};if(r.length){if(f){mt(/'([^']*?)'/g,v+"$1"+b,j),mt(/"([^"]*?)"/g,x+"$1"+k,j);for(var d in ot)mt(RegExp(g(d),"g"),ot[d],j);return xt(),!1}}else{if(f){if(-1!==n.indexOf('"')&&'"'==l[0])return pt.value=n.replace(/"([^"]*?)$/,x+"$1")+k+l.slice(1),vt(o,xt),!1;if(-1!==n.indexOf("'")&&"'"==l[0])return pt.value=n.replace(/'([^']*?)$/,v+"$1")+b+l.slice(1),vt(o,xt),!1;if(n.slice(-2).match(/\w'$/i))return pt.value=n.slice(0,-1)+b+l,vt(o,xt),!1;if(n.match(/\((c|p|sm|tm|r)$/i)&&")"==l[0]){var at=n.match(/\((sm|tm)$/i)?2:1;return pt.value=n.slice(0,-(at+1))+ot["("+n.slice(-at).toLowerCase()+")"]+l.slice(1),vt(o-at,xt),!1}var ct=n.replace(/&lt;/g,"<").replace(/&gt;/g,">"),ut=l.replace(/&lt;/g,"<").replace(/&gt;/g,">");if(-1!==ct.indexOf("<<")&&0===ut.indexOf(">>"))return pt.value=n.replace(/(?:<<|&lt;&lt;)([^<]*)$/,U+"$1")+l.replace(/^(?:>>|&gt;&gt;)/,A),vt(ct.length-1,xt),!1;if(-1!==ct.indexOf("<")&&0===ut.indexOf(">"))return pt.value=n.replace(/(?:<|&lt;)([^<]*)$/,M+"$1")+l.replace(/^(?:>|&gt;)/,B),vt(ct.length,xt),!1;for(var d in ot)if(n.slice(-d.length)==d)return pt.value=n.slice(0,-d.length)+ot[d]+l,vt(i-d.length+1,xt),!1;if(37==a)return gt(K),!1;if(38==a)return gt(q),!1;if(39==a)return gt(D),!1;if(40==a)return gt(Y),!1}if(8==a){if(n.match(RegExp(Et+"$")))return ht(Ct.tabSize),!1;if(n.match(/<\/?[^>]*?>$/))return ht("</?[^>]*?>",1,!0),!1;switch(n.slice(-1)){case"(":return _t("(",")"),!1;case"{":return _t("{","}"),!1;case"[":return _t("[","]"),!1;case'"':return _t('"','"'),!1;case"'":return _t("'","'"),!1;case"<":return _t("<",">"),!1;case x:return _t(x,k),!1;case v:return _t(v,b),!1;case U:return _t(U,A),!1;case M:return _t(M,B),!1}}}return 39==a&&l.match(/^<\/.*?>/)?(vt(o+l.indexOf(">")+1),!1):27==a?(Lt.focus(),!1):void(f||c||u||W.setTimeout(xt,1))});var Nt=RegExp("(^|\\s)"+Ct.areaClass+"(\\s|$)"),Mt=pt.className;Mt.match(Nt)||(pt.className=f(Mt+" "+Ct.areaClass)),Ct.ready(V),V.grip=X,V.grip.config=Ct};