/*!
 * ----------------------------------------------------------
 *  HTML TEXT EDITOR PLUGIN 1.1.1
 * ----------------------------------------------------------
 * Author: Taufik Nurrohman <http://latitudu.com>
 * Licensed under the MIT license.
 *
 * REQUIRES:
 * ==========================================================
 * [1]. https://github.com/tovic/simple-text-editor-library
 * [2]. https://fortawesome.github.io/Font-Awesome/icons
 * ==========================================================
 * ----------------------------------------------------------
 *
 */

var HTE=function(e,t){function n(e){return void 0!==e}function l(e){return"number"==typeof e}function r(e){return"function"==typeof e}function i(e){return"object"==typeof e}function a(e,t,n){t="on"+t,r(e[t])&&(n=function(e,t){return function(){return e.apply(this,arguments),t.apply(this,arguments)}}(e[t],n)),e[t]=n}function o(e,t){e=e||{};for(var n in t)e[n]=i(t[n])?o(e[n],t[n]):t[n];return e}function c(e,t){var n=t.replace(/\-(\w)/g,function(e,t){return t.toUpperCase()}),l=0;return l=G.defaultView&&G.defaultView.getComputedStyle?G.defaultView.getComputedStyle(e,null).getPropertyValue(t):e.style[n]}function s(e,t){return it(e,function(){ct(t.end+1,ut)}),!1}function u(e){return e.replace(/^\s+|\s+$/g,"")}function f(e){return e.replace(/^\s+/,"")}function p(e){return e.replace(/\s+$/,"")}function d(e){return e.replace(W.escape,"\\$1")}function g(e){return e.parentNode}function h(e,t){var n,l=st(),r=e,i=pt.LI,a=r.split(" ")[0],o=i.split(" ")[0];l.value.length>0?l.value==t?ct(l.start,l.end):it("<"+r+">\n"+pt.tabSize+"<"+i+">"+l.value.replace(/\n/g,"</"+o+">\n"+pt.tabSize+"<"+i+">").replace(RegExp("\\n("+pt.tabSize+")?<"+i+"><\\/"+o+">\\n","g"),"\n</"+a+">\n\n<"+r+">\n")+"</"+o+">\n</"+a+">"):it("<"+r+">\n"+pt.tabSize+"<"+i+">"+t+"</"+o+">\n</"+a+">",function(){n=l.start+1+r.length+2+pt.tabSize.length+1+i.length+1,ct(n,n+t.length,ut)})}"prompt"in t&&(t.prompts=t.prompt),"placeholder"in t&&(t.placeholders=t.placeholder),"iconClassPrefix"in t&&(t.toolbarIconClass=t.iconClassPrefix+"%s"),"buttonClassPrefix"in t&&(t.toolbarButtonClass=t.buttonClassPrefix+"%s");var m="\u2018",v="\u2019",x="\u201C",b="\u201D",C="\u2013",k="\u2014",E="\u2026",T="\u00A6",y="\u00A9",L="\u2117",_="\u2120",$="\u2122",O="\u00AE",R="\u00B1",H="\u00D7",S="\u00F7",M="\u00B0",I="\u2039",w="\u203A",N="\u00AB",B="\u00BB",U="\u2264",P="\u2265",z="\u2260",A="\u2190",K="\u2192",D="\u2191",q="\u2193",Y="\u21B5",V=this,F=window,G=document,W=new Editor(e),Q={tabSize:"    ",toolbar:!0,shortcut:!1,areaClass:"editor-area",toolbarClass:"editor-toolbar",toolbarIconClass:"fa fa-%s",toolbarButtonClass:"editor-toolbar-button editor-toolbar-button-%s",toolbarSeparatorClass:"editor-toolbar-separator",toolbarPosition:"before",dropClass:"custom-drop custom-%s-drop",modalClass:"custom-modal custom-modal-%s",modalHeaderClass:"custom-modal-header custom-modal-%s-header",modalContentClass:"custom-modal-content custom-modal-%s-content",modalFooterClass:"custom-modal-action custom-modal-%s-action",modalOverlayClass:"custom-modal-overlay custom-modal-%s-overlay",emptyElementSuffix:">",autoEncodeHTML:!0,P:"p",BR:"br",H_:"h%d",STRONG:"strong",EM:"em",U:"u",STRIKE:'del datetime="%Y-%m-%d"',UL:"ul",OL:"ol",LI:"li",HR:"hr",QUOTE:"q",BLOCKQUOTE:"blockquote",CODE:"code",PRE:"pre",SUB:"sub",SUP:"sup",A:"a",IMG:"img",buttons:{ok:"OK",yes:"Yes",no:"No",cancel:"Cancel",open:"Open",close:"Close",bold:"Bold",italic:"Italic",underline:"Underline",strike:"Strike",superscript:"Superscript",subscript:"Subscript",code:"Code",paragraph:"Paragraph",quote:"Quote",heading:"H1 "+C+" H6",link:"Link",image:"Image",ol:"Ordered List",ul:"Unordered List",rule:"Horizontal Rule",undo:"Undo",redo:"Redo"},prompts:{link_title:"link title goes here"+E,link_title_title:"Link Title",link_url:"http://",link_url_title:"Link URL",image_url:"http://",image_url_title:"Image URL"},placeholders:{text:"text goes here"+E,heading_text:"Heading",link_text:"link text",list_ul_text:"List Item",list_ol_text:"List Item",image_alt:"Image"},keydown:function(){},click:function(){},ready:function(){},copy:function(){},cut:function(){},paste:function(){}},j=G.body,J=G.createElement("div"),X=G.createElement("div"),Z=G.createElement("div"),et=null,tt=0,nt=function(){},lt=e,rt=W.indent,it=W.insert,at=W.outdent,ot=W.replace,ct=W.select,st=W.selection,ut=W.updateHistory,ft=W.wrap,pt=o(Q,t),dt=G.createElement("span"),gt=d(pt.tabSize),ht=d(pt.P.split(" ")[0]),mt=d(pt.LI.split(" ")[0]);V.event=function(e,t,n){return a(t,e,n)},V.modal=function(e,t,n){r(e)&&(n=t,t=e,e="default"),e=e||"default",n=n||{},tt=j.scrollTop||G.documentElement.scrollTop,J.className=pt.modalOverlayClass.replace(/%s/g,e),X.className=pt.modalClass.replace(/%s/g,e),X.innerHTML='<div class="'+pt.modalHeaderClass.replace(/%s/g,e)+'"></div><div class="'+pt.modalContentClass.replace(/%s/g,e)+'"></div><div class="'+pt.modalFooterClass.replace(/%s/g,e)+'"></div>';var l=X.style;l.visibility="hidden",j.appendChild(J),j.appendChild(X),F.setTimeout(function(){var e=X.offsetWidth,t=X.offsetHeight;l.position="absolute",l.top="top"in n?n.top+"px":"50%",l.left="left"in n?n.left+"px":"50%",l.zIndex="9999",l.marginTop=("top"in n?"":tt-t/2)+"px",l.marginLeft=("left"in n?"":0-e/2)+"px",l.visibility="",X.offsetTop<0&&!1 in n&&(l.top=0,l.marginTop=""),X.offsetLeft<0&&!1 in n&&(l.left=0,l.marginLeft="")},10),r(t)&&t(J,X)},V.drop=function(e,t,n){r(e)&&(n=t,t=e,e="default"),!n&&et&&(n={top:et.offsetTop+et.offsetHeight,left:et.offsetLeft}),e=e||"default",n=n||{},tt=j.scrollTop||G.documentElement.scrollTop,Z.className=pt.dropClass.replace(/%s/g,e);var l=Z.style;l.visibility="hidden",j.appendChild(Z),F.setTimeout(function(){var e=Z.offsetWidth,t=Z.offsetHeight,r=j.offsetWidth,i=j.offsetHeight;l.position="absolute",l.top="top"in n?n.top+"px":"50%",l.left="left"in n?n.left+"px":"50%",l.zIndex="9999",l.marginTop=("top"in n?"":tt-t/2)+"px",l.marginLeft=("left"in n?"":0-e/2)+"px",l.visibility="",n.top+t>i&&(l.top=i-t+"px",l.marginTop=""),n.left+e>r&&(l.left=r-e+"px",l.marginLeft="")},10),r(t)&&t(Z)},V.prompt=function(e,t,n,l,i){V.modal("prompt",function(i,o){var c=function(e){r(l)?(V.close(),l(e)):V.close(!0)},s=G.createElement("input");s.type="text",s.value=t,a(s,"keydown",function(e){if(n){if(13==e.keyCode&&""!==this.value&&this.value!==t)return c(this.value),!1}else if(13==e.keyCode)return c(this.value==t?"":this.value),!1});var u=G.createElement("button");u.innerHTML=pt.buttons.ok,a(u,"click",function(){return n?""!==s.value&&s.value!==t&&c(s.value):c(s.value==t?"":s.value),!1});var f=G.createElement("button");f.innerHTML=pt.buttons.cancel,a(f,"click",function(){return V.close(!0),!1}),o.children[0].innerHTML=e?e:"",o.children[1].appendChild(s),o.children[2].appendChild(u),o.children[2].appendChild(G.createTextNode(" ")),o.children[2].appendChild(f),F.setTimeout(function(){s.select()},10)},i)},V.alert=function(e,t,n,l){V.modal("alert",function(l,i){var o=G.createElement("button");o.innerHTML=pt.buttons.ok,a(o,"click",function(){return r(n)?(V.close(),n()):V.close(!0),!1}),i.children[0].innerHTML=e?e:"",i.children[1].innerHTML=t?t:"",i.children[2].appendChild(o)},l)},V.confirm=function(e,t,l,i){V.modal("confirm",function(i,o){var c=G.createElement("button");c.innerHTML=pt.buttons.ok,a(c,"click",function(){return n(l)&&r(l.OK)?(V.close(),l.OK()):V.close(!0),!1});var s=G.createElement("button");s.innerHTML=pt.buttons.cancel,a(s,"click",function(){return n(l)&&r(l.CANCEL)?(V.close(),l.CANCEL()):V.close(!0),!1}),o.children[0].innerHTML=e?e:"",o.children[1].innerHTML=t?t:"",o.children[2].appendChild(c),o.children[2].appendChild(G.createTextNode(" ")),o.children[2].appendChild(s)},i)},V.close=function(e){if(g(J)&&j.removeChild(J),g(X)&&j.removeChild(X),g(Z)&&j.removeChild(Z),e&&e!==!1){var t=st();i(e)||(e={}),ct("start"in e?e.start:t.start,"end"in e?e.end:t.end)}},V.scroll=function(e,t){l(e)?lt.scrollTop=e:lt.scrollTop+=parseInt(c(lt,"line-height"),10),r(t)&&t()},V.time=function(e){var t=new Date,l=t.getFullYear(),r=t.getMonth()+1,i=t.getDate(),a=t.getHours(),o=t.getMinutes(),c=t.getSeconds(),s=t.getMilliseconds();10>r&&(r="0"+r),10>i&&(i="0"+i),10>a&&(a="0"+a),10>o&&(o="0"+o),10>c&&(c="0"+c),10>s&&(s="0"+s);var u={Y:""+l,m:""+r,d:""+i,H:""+a,i:""+o,s:""+c,u:""+s};return n(e)?u[e]:u},pt.toolbar&&(dt.className=pt.toolbarClass,lt.parentNode.insertBefore(dt,"before"==pt.toolbarPosition?lt:null));var vt=G.createElement("a");vt.href="#esc:"+(new Date).getTime(),vt.style.width=0,vt.style.height=0,lt.parentNode.appendChild(vt),a(J,"click",function(){V.close(!0)}),V.button=function(e,t){if("|"===e)return V.separator(t);if(t=t||{},t.title!==!1){var n=G.createElement("a");if(n.className=pt.toolbarButtonClass.replace(/%s/g,e),n.setAttribute("tabindex",-1),n.href="#"+e.replace(" ",":").replace(/[^a-z0-9\:]/gi,"-").replace(/-+/g,"-").replace(/^-|-$/g,""),n.innerHTML=t.text?t.text.replace(/%s/g,e):'<i class="'+pt.toolbarIconClass.replace(/%s/g,e)+'"></i>',t.title&&(n.title=t.title),i(t.attr))for(var l in t.attr){var o="class"==l?"className":l;"+="==t.attr[l].slice(0,2)?n[o]+=t.attr[l].slice(2):n[o]=t.attr[l]}if(a(n,"click",function(e){return r(t.click)?(et=n,t.click(e,V),pt.click(e,V,this.hash.replace("#","")),!1):void 0}),t.position){var c=t.position<0?t.position+dt.children.length+1:t.position-1;dt.insertBefore(n,dt.children[c])}else dt.appendChild(n);Q.buttons[e]=t}},V.separator=function(e){e=e||{};var t=G.createElement("span");if(t.className=pt.toolbarSeparatorClass,i(e.attr))for(var n in e.attr){var l="class"==n?"className":n;"+="==e.attr[n].slice(0,2)?t[l]+=e.attr[n].slice(2):t[l]=e.attr[n]}if(e.position){var r=e.position<0?e.position+dt.children.length+1:e.position-1;dt.insertBefore(t,dt.children[r])}else dt.appendChild(t)},W.toggle=function(e,t,n,l){var i=st();if(i.before.slice(-e.length)!=e&&i.after.slice(0,t.length)!=t)ft(e,t,0===i.value.length&&l?function(){ot(/^.*$/,l===!0?pt.placeholders.text:l)}:1);else{var a=i.before.slice(-e.length)==e?i.before.slice(0,-e.length):i.before,o=i.after.slice(0,t.length)==t?i.after.slice(t.length):i.after;lt.value=a+i.value+o,ct(a.length,a.length+i.value.length,ut)}r(n)&&n()};var xt=W.toggle,bt=0,Ct=pt.buttons;if(i(Ct)){var kt={bold:{title:Ct.bold,click:function(){var e=pt.STRONG;xt("<"+e+">","</"+e.split(" ")[0]+">",1,!0)}},italic:{title:Ct.italic,click:function(){var e=pt.EM;xt("<"+e+">","</"+e.split(" ")[0]+">",1,!0)}},underline:{title:Ct.underline,click:function(){var e=pt.U;xt("<"+e+">","</"+e.split(" ")[0]+">",1,!0)}},strikethrough:{title:Ct.strike,click:function(){var e=V.time(),t=pt.STRIKE;t=t.replace(/%Y/g,e.Y).replace(/%m/g,e.m).replace(/%d/g,e.d).replace(/%H/g,e.H).replace(/%i/g,e.i).replace(/%s/g,e.s).replace(/%u/g,e.u),xt("<"+t+">","</"+t.split(" ")[0]+">",1,!0)}},code:{title:Ct.code,click:function(){var e=st().value,t=pt.CODE,n=pt.PRE,l=t.split(" ")[0],r=n.split(" ")[0],i=-1===e.indexOf("\n"),a=i?"<"+t+">":"<"+n+"><"+t+">",o=i?"</"+l+">":"</"+l+"></"+r+">";if(e.length>0){var c=st(),s=c.before,u=c.after,f=c.value,p=d(l),g=d(r);s.match(RegExp("(<"+g+"(>| .*?>))?<"+p+"(>| .*?>)$"))&&u.match(RegExp("^<\\/"+p+">(<\\/"+g+">)?"))?(s=s.replace(RegExp("(<"+g+"(>| .*?>))?<"+p+"(>| .*?>)$"),""),u=u.replace(RegExp("^<\\/"+p+">(<\\/"+g+">)?"),""),pt.autoEncodeHTML&&(f=f.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">")),lt.value=s+f+u,ct(s.length,s.length+f.length,ut)):(pt.autoEncodeHTML&&(f=f.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),lt.value=s+a+f+o+u,ct(s.length+a.length,s.length+f.length+a.length,ut))}else xt(a,o,1,!0)}},paragraph:{title:Ct.paragraph,click:function(){var e=st().value,t=pt.P,n=t.split(" ")[0],l=d(n);e.length>0?RegExp("^<"+l+"(>| .*?>)|<\\/"+l+">$").test(e)?ot(RegExp("<"+l+"(>| .*?>)([\\s\\S]*?)<\\/"+l+">","g"),"$2"):(ot(/^/,"<"+t+">",nt),ot(/$/,"</"+n+">",nt),ot(/\n/g,"</"+n+">\n<"+t+">",nt),ot(RegExp("<"+n+"(>| .*?>)<\\/"+n+">","g"),"",nt),ot(RegExp("(<"+n+"(>| .*?>))+","g"),"$1",nt),ot(RegExp("(<\\/"+n+">)+","g"),"$1")):xt("<"+t+">","</"+n+">")}},"quote-right":{title:Ct.quote,click:function(){var e=st(),t=pt.QUOTE,n=pt.BLOCKQUOTE;0===e.start||e.before.match(/\n$/)?xt("<"+n+">","</"+n.split(" ")[0]+">",1,!0):e.before.match(RegExp("<"+n.split(" ")[0]+"(>| .*?>)$"))?xt("<"+n+">","</"+n.split(" ")[0]+">",1,!0):xt("<"+t+">","</"+t.split(" ")[0]+">",1,!0)}},header:{title:Ct.heading,click:function(){var e,t,n,l=st(),r=pt.H_,i=r.split(" ")[0],a=d(i).replace(/%d/g,"[1-6]"),o=pt.P,c=o.split(" ")[0],s=d(c),g="<\\/?(?:"+a+"|"+s+")(>| .*?>)",h=p(l.before.replace(RegExp(g+"$"),"")).length>0?"\n\n":"",m=p(l.before.replace(RegExp(g+"$","g"),"")),v=u(l.value.replace(RegExp("^"+g+"|"+g+"$","g"),"").replace(/\n+/g," ")),x=f(l.after.replace(RegExp("^"+g,"g"),"")),b=l.value.match(RegExp("^"+g))?RegExp("^"+g).exec(l.value):RegExp(g+"$").exec(l.before);if(b=b?b[1]:">",bt=6>bt?bt+1:0,l.value.length>0)l.before.match(RegExp(g+"$"))?(n=i.replace(/%d/g,bt),lt.value=m+h+"<"+(bt>0?n:c)+b+v+"</"+(bt>0?n:c)+">\n\n"+x,e=m.length+h.length+1+(bt>0?n.length:c.length)+b.length):(t=r.replace(/%d/g,bt),n=i.replace(/%d/g,bt),lt.value=m+h+"<"+(bt>0?t:o)+b+v+"</"+(bt>0?n:c)+">\n\n"+x,e=m.length+h.length+1+(bt>0?t.length:o.length)+b.length),ct(e,e+v.length,ut);else{var C=pt.placeholders.heading_text;r=r.replace(/%d/g,1),i=i.replace(/%d/g,1),bt=1,lt.value=p(l.before)+h+"<"+r+">"+C+"</"+i+">\n\n"+f(l.after),e=p(l.before).length+h.length+1+r.length+1,ct(e,e+C.length,ut)}}},link:{title:Ct.link,click:function(){var e,t,n=st(),l=pt.A,r=l.split(" ")[0],i=pt.placeholders.link_text;V.prompt(pt.prompts.link_url_title,pt.prompts.link_url,!0,function(a){t=a,V.prompt(pt.prompts.link_title_title,pt.prompts.link_title,!1,function(a){e=a,ft("<"+l+' href="'+t+'"'+(""!==e?' title="'+e+'"':"")+">","</"+r+">",0===n.value.length?function(){ot(/^/,i)}:1)})})}},image:{title:Ct.image,click:function(){V.prompt(pt.prompts.image_url_title,pt.prompts.image_url,!0,function(e){var t=st(),n=p(t.before),l=f(t.after),r=n.length>0?"\n\n":"",i=pt.emptyElementSuffix,a=decodeURIComponent(e.substring(e.lastIndexOf("/")+1,e.lastIndexOf(".")).replace(/[-+._]+/g," ")).toLowerCase().replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()});a=-1===a.indexOf("/")&&-1!==e.indexOf(".")?a:pt.placeholders.image_alt,lt.value=n+r+"<"+pt.IMG+' alt="'+a+'" src="'+e+'"'+i+"\n\n"+l,ct(n.length+r.length+1+pt.IMG.length+6+a.length+7+e.length+1+i.length+2,ut)})}},"list-ol":{title:Ct.ol,click:function(){h(pt.OL,pt.placeholders.list_ol_text)}},"list-ul":{title:Ct.ul,click:function(){h(pt.UL,pt.placeholders.list_ul_text)}},superscript:{title:Ct.superscript,click:function(){var e=pt.SUP;xt("<"+e+">","</"+e.split(" ")[0]+">",1,!0)}},subscript:{title:Ct.subscript,click:function(){var e=pt.SUB;xt("<"+e+">","</"+e.split(" ")[0]+">",1,!0)}},"ellipsis-h":{title:Ct.rule,click:function(){var e=st(),t=p(e.before),n=f(e.after),l=t.length>0?"\n\n":"",r=pt.HR,i=pt.emptyElementSuffix;lt.value=t+l+"<"+r+i+"\n\n"+n,ct(t.length+l.length+1+r.length+i.length+2,ut)}},undo:{title:Ct.undo,click:W.undo},repeat:{title:Ct.redo,click:W.redo}};for(var Et in kt)V.button(Et,kt[Et])}a(lt,"focus",V.close),a(lt,"copy",function(){var e=st();F.setTimeout(function(){pt.copy(e)},1)}),a(lt,"cut",function(){var e=st();F.setTimeout(function(){e.end=e.start,pt.cut(e),ut()},1)}),a(lt,"paste",function(){var e=st();F.setTimeout(function(){e.end=st().end,e.value=lt.value.substring(e.start,e.end),pt.paste(e),ut()},1)}),a(lt,"keydown",function(e){var t=st(),n=t.before,l=t.value,r=t.after,i=t.start,a=t.end,o=e.keyCode,c=e.ctrlKey,u=e.shiftKey,f=e.altKey,p=9==o;F.setTimeout(function(){pt.keydown(e,V)},1);var g=n,h=r[0],G="\\"==g.slice(-1);if(-1!==g.indexOf("(")&&u&&48==o&&")"==h&&!G||-1!==g.indexOf("{")&&u&&221==o&&"}"==h&&!G||-1!==g.indexOf("[")&&221==o&&"]"==h&&!G||-1!==g.indexOf('"')&&u&&222==o&&'"'==h&&!G||-1!==g.indexOf("'")&&!u&&222==o&&"'"==h&&!G||-1!==g.indexOf("`")&&!u&&192==o&&"`"==h&&!G||-1!==g.indexOf("<")&&u&&190==o&&">"==h&&!G)return ct(a+1),!1;if(u&&57==o&&!G)return s("("+l+")",t);if(u&&219==o&&!G)return s("{"+l+"}",t);if(!u&&219==o&&!G)return s("["+l+"]",t);if(u&&222==o&&!G)return s('"'+l+'"',t);if(!u&&222==o&&!G)return s("'"+l+"'",t);if(!u&&192==o&&!G)return s("`"+l+"`",t);if(u&&188==o&&!G)return s("<"+l+">",t);if(u&&p)return at(pt.tabSize),!1;if(p){if(n.match(/<[^\/>]*?$/)&&">"==r[0]){var Q=/<([^\/>]*?)$/.exec(n);return lt.value=n+" "+l+"></"+Q[1].split(" ")[0]+r,ct(i+1,ut),!1}return rt(pt.tabSize),!1}if(c&&90==o)return W.undo(),!1;if(c&&89==o||c&&82==o)return W.redo(),!1;if(pt.shortcut){if(c&&66==o)return kt.bold.click(),!1;if(c&&73==o)return kt.italic.click(),!1;if(c&&81==o)return kt["quote-right"].click(),!1;if(c&&72==o)return kt.header.click(),!1;if(c&&76==o)return kt.link.click(),!1;if(c&&71==o)return kt.image.click(),!1}if(13==o){if(f&&0===l.length)return it(Y),!1;if(c)return kt.paragraph.click(),!1;if(u)return it("<"+pt.BR+pt.emptyElementSuffix+"\n"),V.scroll(),!1;var j=pt.LI.split(" ")[0];if(n.match(RegExp("<\\/"+mt+">$"))){var Q=RegExp("(?:^|\\n)([\\t ]*)<"+mt+"(>| .*?>).*?<\\/"+mt+">$").exec(n);return it("\n"+Q[1]+"<"+j+Q[2]+"</"+j+">",function(){ct(a+Q[1].length+Q[2].length+4,ut)}),V.scroll(),!1}if(r.match(RegExp("^<\\/"+mt+">"))&&">"!=n.slice(-1)){var Q=RegExp("(?:^|\\n)([\\t ]*)<"+mt+"(>| .*?>).*$").exec(n);return it("</"+j+">\n"+Q[1]+"<"+j+Q[2]),V.scroll(),!1}var J=pt.P.split(" ")[0];if(r.match(RegExp("^<\\/"+ht+">"))){var Q=RegExp("(?:^|\\n?)([\\t ]*)<"+ht+"(>| .*?>).*$").exec(n);return it("</"+J+">\n"+Q[1]+"<"+J+Q[2]),V.scroll(),!1}var X=RegExp("(?:^|\\n)(("+gt+")+)(.*?)$").exec(n),Z=X?X[1]:"";return n.match(/[\(\{\[]$/)&&r.match(/^[\]\}\)]/)||n.match(/<[^\/>]*?>$/)&&r.match(/^<\//)?(it("\n"+Z+pt.tabSize+"\n"+Z,function(){ct(i+Z.length+pt.tabSize.length+1,ut)}),V.scroll(),!1):(it("\n"+Z),V.scroll(),!1)}var et={"'":v,'"':b,"---":k,"--":C,"...":E,"|":T,"(c)":y,"(C)":y,"(p)":L,"(P)":L,"(sm)":_,"(SM)":_," sm":_," SM":_,"(tm)":$,"(TM)":$," tm":$," TM":$,"(r)":O,"(R)":O,"+-":R,"-+":R,x:H,"/":S,"^":M,"<<":N,">>":B,"<":I,">":w,"<=":U,">=":P,"!=":z};if(l.length>0){if(f){ot(/'([^']*?)'/g,m+"$1"+v,nt),ot(/"([^"]*?)"/g,x+"$1"+b,nt);for(var tt in et)ot(RegExp(d(tt),"g"),et[tt],nt);return ut(),!1}}else{if(f){if(-1!==n.indexOf('"')&&'"'==r[0])return lt.value=n.replace(/"([^"]*?)$/,x+"$1")+b+r.slice(1),ct(a,ut),!1;if(-1!==n.indexOf("'")&&"'"==r[0])return lt.value=n.replace(/'([^']*?)$/,m+"$1")+v+r.slice(1),ct(a,ut),!1;if(n.slice(-2).match(/\w'$/i))return lt.value=n.slice(0,-1)+v+r,ct(a,ut),!1;if(n.match(/\((c|p|sm|tm|r)$/i)&&")"==r[0]){var ft=n.match(/\((sm|tm)$/i)?2:1;return lt.value=n.slice(0,-(ft+1))+et["("+n.slice(-ft).toLowerCase()+")"]+r.slice(1),ct(a-ft,ut),!1}var dt=n.replace(/&lt;/g,"<").replace(/&gt;/g,">"),bt=r.replace(/&lt;/g,"<").replace(/&gt;/g,">");if(-1!==dt.indexOf("<<")&&0===bt.indexOf(">>"))return lt.value=n.replace(/(?:<<|&lt;&lt;)([^<]*)$/,N+"$1")+r.replace(/^(?:>>|&gt;&gt;)/,B),ct(dt.length-1,ut),!1;if(-1!==dt.indexOf("<")&&0===bt.indexOf(">"))return lt.value=n.replace(/(?:<|&lt;)([^<]*)$/,I+"$1")+r.replace(/^(?:>|&gt;)/,w),ct(dt.length,ut),!1;for(var tt in et)if(n.slice(-tt.length)==tt)return lt.value=n.slice(0,-tt.length)+et[tt]+r,ct(i-tt.length+1,ut),!1;if(37==o)return it(A),!1;if(38==o)return it(D),!1;if(39==o)return it(K),!1;if(40==o)return it(q),!1}if(8==o){if(n.match(RegExp(gt+"$")))return at(pt.tabSize),!1;if(n.match(/<\/?[^>]*?>$/))return at("</?[^>]*?>",1,!0),!1;switch(n.slice(-1)){case"(":return xt("(",")"),!1;case"{":return xt("{","}"),!1;case"[":return xt("[","]"),!1;case'"':return xt('"','"'),!1;case"'":return xt("'","'"),!1;case"<":return xt("<",">"),!1;case"*":return xt("*","*"),!1;case"_":return xt("_","_"),!1;case"~":return xt("~","~"),!1;case"`":return xt("`","`"),!1;case x:return xt(x,b),!1;case m:return xt(m,v),!1;case N:return xt(N,B),!1;case I:return xt(I,w),!1}}}return 39==o&&r.match(/^<\/.*?>/)?(ct(a+r.indexOf(">")+1),!1):27==o?(vt.focus(),!1):void(f||c||u||F.setTimeout(ut,1))});var Tt=RegExp("(^| )"+pt.areaClass+"( |$)"),yt=lt.className;yt.match(Tt)||(lt.className=u(yt+" "+pt.areaClass)),pt.ready(V),V.grip=W,V.grip.config=pt};