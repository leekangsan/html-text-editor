/*!
 * ----------------------------------------------------------
 *  HTML TEXT EDITOR PLUGIN 1.3.0
 * ----------------------------------------------------------
 * Author: Taufik Nurrohman <http://latitudu.com>
 * Licensed under the MIT license.
 *
 * REQUIRES:
 * ==========================================================
 * [1]. https://github.com/tovic/simple-text-editor-library
 * [2]. https://fortawesome.github.io/Font-Awesome/icons
 * ==========================================================
 * ----------------------------------------------------------
 *
 */

var HTE=function(e,t){function n(e){return void 0!==e}function l(e){return"string"==typeof e}function r(e){return"number"==typeof e}function i(e){return"function"==typeof e}function a(e){return"object"==typeof e}function o(e,t,n){return t="on"+t,null===n?e[t]=null:(i(e[t])&&(n=function(e,t){return function(){return e.apply(this,arguments),t.apply(this,arguments)}}(e[t],n)),void(e[t]=n))}function c(e,t){e=e||{};for(var n in t)e[n]=a(t[n])?c(e[n],t[n]):t[n];return e}function u(e,t){var n=t.replace(/\-(\w)/g,function(e,t){return t.toUpperCase()}),l=0;return l=F.defaultView&&F.defaultView.getComputedStyle?F.defaultView.getComputedStyle(e,null).getPropertyValue(t):e.style[n]}function s(e,t){return gt(e,function(){vt(t.end+1,xt)}),!1}function f(e){return e.replace(/^\s+|\s+$/g,"")}function p(e){return e.replace(/^\s+/,"")}function d(e){return e.replace(/\s+$/,"")}function g(e){return e.replace(j.escape,"\\$1")}function h(e){return e.parentNode}function m(e,t){var n,l=bt(),r=e,i=Ct.LI,a=r.split(" ")[0],o=i.split(" ")[0];if(l.value.length>0){var c=/([\s\S]*?)<(?:ol|ul)(>| .*?>)([\s\S]*?)<\/(?:ol|ul)>([\s\S]*?)/g;l.value==t?vt(l.start,l.end):l.value.match(c)?mt(c,"$1<"+a+"$2$3</"+a+">$4"):gt("<"+r+">\n"+Ct.tabSize+"<"+i+">"+l.value.replace(/\n/g,"</"+o+">\n"+Ct.tabSize+"<"+i+">").replace(RegExp("\\n("+Ct.tabSize+")?<"+i+"><\\/"+o+">\\n","g"),"\n</"+a+">\n\n<"+r+">\n")+"</"+o+">\n</"+a+">")}else if(l.after.match(RegExp("^<\\/"+o+">"))){var u=/(?:^|\n)([\t ]*).*?$/.exec(l.before),s=u?u[1]:"";gt("\n"+s+Ct.tabSize+"<"+r+">\n"+s+Ct.tabSize+Ct.tabSize+"<"+i+">"+t+"</"+o+">\n"+s+Ct.tabSize+"</"+a+">\n"+s,function(){n=bt().end-s.length-1-1-a.length-2-Ct.tabSize.length-s.length-1-1-o.length-2,vt(n-t.length,n,xt)})}else if(l.before.match(/<\/(?:ol|ul)>\s?$/))pt.value=l.before.replace(/<(?:ol|ul)(>| .*?>)([\s\S]*?)<\/(?:ol|ul)>(\s?)$/g,"<"+a+"$1$2</"+a+">$3")+l.after,vt(l.end,xt);else{var f=l.before.length>0?"\n\n":"",g=d(l.before),h="<"+r+">\n"+Ct.tabSize+"<"+i+">"+t+"</"+o+">\n</"+a+">\n\n";n=g.length+f.length+1+r.length+2+Ct.tabSize.length+1+i.length+1,pt.value=g+f+h+p(l.after),vt(n,n+t.length,xt)}}var v="\u2018",b="\u2019",x="\u201C",k="\u201D",C="\u2013",E="\u2014",y="\u2026",$="\u00A6",T="\u00A9",R="\u2117",L="\u2120",S="\u2122",H="\u00AE",O="\u00B1",_="\u00D7",M="\u00F7",w="\u00B0",N="\u2039",z="\u203A",I="\u00AB",U="\u00BB",B="\u2264",A="\u2265",P="\u2260",K="\u2190",q="\u2192",Y="\u2191",D="\u2193",G="\u21B5",Q="\u00B7",V=this,W=window,F=document,j=new Editor(e),X={tabSize:"    ",toolbar:!0,shortcut:!1,areaClass:"editor-area",toolbarClass:"editor-toolbar",toolbarIconClass:"fa fa-%s",toolbarButtonClass:"editor-toolbar-button editor-toolbar-button-%s",toolbarSeparatorClass:"editor-toolbar-separator",toolbarPosition:"before",dropClass:"custom-drop custom-%s-drop",modalClass:"custom-modal custom-modal-%s",modalHeaderClass:"custom-modal-header custom-modal-%s-header",modalContentClass:"custom-modal-content custom-modal-%s-content",modalFooterClass:"custom-modal-action custom-modal-%s-action",modalOverlayClass:"custom-modal-overlay custom-modal-%s-overlay",emptyElementSuffix:">",autoEncodeHTML:!0,P:"p",BR:"br",H_:"h%d",STRONG:"strong",EM:"em",U:"u",STRIKE:'del datetime="%Y-%m-%d"',UL:"ul",OL:"ol",LI:"li",HR:"hr",QUOTE:"q",BLOCKQUOTE:"blockquote",CODE:"code",PRE:"pre",SUB:"sub",SUP:"sup",A:"a",IMG:"img",buttons:{ok:"OK",yes:"Yes",no:"No",cancel:"Cancel",open:"Open",close:"Close",bold:"Bold",italic:"Italic",underline:"Underline",strike:"Strike",superscript:"Superscript",subscript:"Subscript",code:"Code",paragraph:"Paragraph",quote:"Quote",heading:"H1 "+C+" H6",link:"Link",image:"Image",ol:"Ordered List",ul:"Unordered List",rule:"Horizontal Rule",undo:"Undo",redo:"Redo"},prompts:{link_title:"link title goes here"+y,link_title_title:"Link Title",link_url:"http://",link_url_title:"Link URL",image_url:"http://",image_url_title:"Image URL"},placeholders:{text:"text goes here"+y,heading_text:"Heading",link_text:"link text",list_ul_text:"List item",list_ol_text:"List item",image_alt:"Image"},update:function(){},keydown:function(){},click:function(){},ready:function(){},copy:function(){},cut:function(){},paste:function(){}},J=F.body,Z=F.createElement("div"),et=F.createElement("div"),tt=F.createElement("div"),nt=0,lt=null,rt=null,it=0,at=0,ot=0,ct=0,ut=J.parentNode.offsetWidth,st=W.innerHeight>J.parentNode.offsetHeight?W.innerHeight:J.parentNode.offsetHeight,ft=function(){},pt=e,dt=j.indent,gt=j.insert,ht=j.outdent,mt=j.replace,vt=j.select,bt=j.selection,xt=j.updateHistory,kt=j.wrap,Ct=c(X,t),Et=F.createElement("span"),yt=g(Ct.tabSize),$t=g(Ct.P.split(" ")[0]),Tt=g(Ct.LI.split(" ")[0]);V.event=function(e,t,n){return o(t,e,n)},V.modal=function(e,t,n){i(e)&&(n=t,t=e,e="default"),e=e||"default",n=n||{},nt=J.scrollTop||J.parentNode.scrollTop,Z.className=Ct.modalOverlayClass.replace(/%s/g,e),et.className=Ct.modalClass.replace(/%s/g,e),et.innerHTML='<div class="'+Ct.modalHeaderClass.replace(/%s/g,e)+'"></div><div class="'+Ct.modalContentClass.replace(/%s/g,e)+'"></div><div class="'+Ct.modalFooterClass.replace(/%s/g,e)+'"></div>';var l=et.style,r="left"in n,a="top"in n;l.visibility="hidden",J.appendChild(Z),J.appendChild(et),W.setTimeout(function(){var e=et.offsetWidth,t=et.offsetHeight;l.position="absolute",l.left=r?n.left+"px":"50%",l.top=a?n.top+"px":"50%",l.zIndex="9999",l.marginLeft=(r?0:0-e/2)+"px",l.marginTop=(a?0:nt-t/2)+"px",l.visibility="",et.offsetLeft<0&&!r&&(l.left=0,l.marginLeft=0,r=!0,n.left=0),et.offsetTop<0&&!a&&(l.top=0,l.marginTop=0,a=!0,n.top=0);var i=et.children[0];o(i,"mousedown",function(){return rt=et,ot=it-rt.offsetLeft,ct=at-rt.offsetTop,!1}),o(J,"mousemove",null),o(J,"mousemove",function(n){it=n.pageX,at=n.pageY+nt;var i,o,c=r?0:e/2,u=a?0:t/2;if(null!==rt){var s=r?e:0,f=a?t:0;i=it-ot+c,o=at-ct+u,c>i&&(i=c),u>o&&(o=u),i+c+s>ut&&(i=ut-c-s),o+u+f>st&&(o=st-u-f),l.left=i+"px",l.top=o-nt+"px"}})},10),i(t)&&t(Z,et)},V.drop=function(e,t,n){i(e)&&(n=t,t=e,e="default"),!n&&lt&&(n={left:lt.offsetLeft,top:lt.offsetTop+lt.offsetHeight}),e=e||"default",n=n||{},nt=J.scrollTop||J.parentNode.scrollTop,tt.className=Ct.dropClass.replace(/%s/g,e);var l=tt.style,r="left"in n,a="top"in n;l.visibility="hidden",J.appendChild(tt),W.setTimeout(function(){var e=tt.offsetWidth,t=tt.offsetHeight;l.position="absolute",l.left=r?n.left+"px":"50%",l.top=a?n.top+"px":"50%",l.zIndex="9999",l.marginLeft=(r?0:0-e/2)+"px",l.marginTop=(a?0:nt-t/2)+"px",l.visibility="",n.left+e>ut&&(l.left=ut-e+"px",l.marginLeft=0),n.top+t>st&&(l.top=st-t+"px",l.marginTop=0)},10),i(t)&&t(tt)},V.prompt=function(e,t,n,l,r){V.modal("prompt",function(r,a){var c=function(e){i(l)?(V.close(),l(e)):V.close(!0)},u=F.createElement("input");u.type="text",u.value=t,o(u,"keydown",function(e){var l=e.keyCode;if(27==l)return V.close(!0),!1;if(40==l)return s.focus(),!1;if(n){if(13==l&&""!==this.value&&this.value!==t)return c(this.value),!1}else if(13==l)return c(this.value==t?"":this.value),!1});var s=F.createElement("button");s.innerHTML=Ct.buttons.ok,o(s,"click",function(){return n?""!==u.value&&u.value!==t&&c(u.value):c(u.value==t?"":u.value),!1});var f=F.createElement("button");f.innerHTML=Ct.buttons.cancel,o(f,"click",function(){return V.close(!0),!1}),o(s,"keydown",function(e){var t=e.keyCode;return 27==t?(V.close(!0),!1):38==t?(u.focus(),!1):39==t?(f.focus(),!1):void 0}),o(f,"keydown",function(e){var t=e.keyCode;return 27==t?(V.close(!0),!1):37==t?(s.focus(),!1):38==t?(u.focus(),!1):void 0}),a.children[0].innerHTML=e?e:"",a.children[1].appendChild(u),a.children[2].appendChild(s),a.children[2].appendChild(F.createTextNode(" ")),a.children[2].appendChild(f),W.setTimeout(function(){u.select()},10)},r)},V.alert=function(e,t,n,l){V.modal("alert",function(l,r){var a=F.createElement("button");a.innerHTML=Ct.buttons.ok,o(a,"click",function(){return i(n)?(V.close(),n()):V.close(!0),!1}),o(a,"keydown",function(e){return 27==e.keyCode?(V.close(!0),!1):void 0}),r.children[0].innerHTML=e?e:"",r.children[1].innerHTML=t?t:"",r.children[2].appendChild(a),W.setTimeout(function(){a.focus()},10)},l)},V.confirm=function(e,t,l,r){V.modal("confirm",function(r,a){var c=F.createElement("button");c.innerHTML=Ct.buttons.ok,o(c,"click",function(){return n(l)&&i(l.OK)?(V.close(),l.OK()):V.close(!0),!1});var u=F.createElement("button");u.innerHTML=Ct.buttons.cancel,o(u,"click",function(){return n(l)&&i(l.CANCEL)?(V.close(),l.CANCEL()):V.close(!0),!1}),o(c,"keydown",function(e){var t=e.keyCode;return 27==t?(V.close(!0),!1):39==t?(u.focus(),!1):void 0}),o(u,"keydown",function(e){var t=e.keyCode;return 27==t?(V.close(!0),!1):37==t?(c.focus(),!1):void 0}),a.children[0].innerHTML=e?e:"",a.children[1].innerHTML=t?t:"",a.children[2].appendChild(c),a.children[2].appendChild(F.createTextNode(" ")),a.children[2].appendChild(u),W.setTimeout(function(){u.focus()},10)},r)},V.close=function(e){if(lt=null,rt=null,h(Z)&&J.removeChild(Z),h(et)&&J.removeChild(et),h(tt)&&J.removeChild(tt),e&&e!==!1){var t=bt();a(e)||(e={}),vt("start"in e?e.start:t.start,"end"in e?e.end:t.end)}},o(W,"resize",function(){ut=J.parentNode.offsetWidth,st=W.innerHeight>J.parentNode.offsetHeight?W.innerHeight:J.parentNode.offsetHeight}),o(J,"mouseup",function(){rt=null}),o(Z,"click",function(){V.close(!0)}),V.scroll=function(e,t){r(e)?pt.scrollTop=e:pt.scrollTop+=parseInt(u(pt,"line-height"),10),i(t)&&t()},V.time=function(e){var t=new Date,l=t.getFullYear(),r=t.getMonth()+1,i=t.getDate(),a=t.getHours(),o=t.getMinutes(),c=t.getSeconds(),u=t.getMilliseconds();10>r&&(r="0"+r),10>i&&(i="0"+i),10>a&&(a="0"+a),10>o&&(o="0"+o),10>c&&(c="0"+c),10>u&&(u="0"+u);var s={Y:""+l,m:""+r,d:""+i,H:""+a,i:""+o,s:""+c,u:""+u};return n(e)?s[e]:s},Ct.toolbar&&(Et.className=Ct.toolbarClass,pt.parentNode.insertBefore(Et,"before"==Ct.toolbarPosition?pt:null));var Rt=F.createElement("a");Rt.href="#esc:"+(new Date).getTime(),Rt.style.width=0,Rt.style.height=0,pt.parentNode.appendChild(Rt),V.button=function(e,t){if("|"===e)return V.separator(t);if(t=t||{},t.title!==!1){var n,c=F.createElement("a");if(c.className=Ct.toolbarButtonClass.replace(/%s/g,e),c.setAttribute("tabindex",-1),c.href="#"+e.replace(" ",":").replace(/[^a-z0-9\:]/gi,"-").replace(/-+/g,"-").replace(/^-|-$/g,""),c.innerHTML=t.text?t.text.replace(/%s/g,e):'<i class="'+Ct.toolbarIconClass.replace(/%s/g,e)+'"></i>',t.title&&(c.title=t.title),a(t.attr))for(var u in t.attr)if(l(t.attr[u])&&"+="==t.attr[u].slice(0,2)){var s=c.getAttribute(u)||"";c.setAttribute(u,s+t.attr[u].slice(2))}else c.setAttribute(u,t.attr[u]);o(c,"click",function(e){if(i(t.click)){var n=this.hash.replace("#","");return V.close(),lt=c,t.click(e,V),Ct.click(e,V,n),Ct.update(e,V,n),!1}}),o(c,"keydown",function(e){return 27==e.keyCode?(V.close(!0),!1):void 0}),r(t.position)?(n=t.position<0?t.position+Et.children.length+1:t.position-1,Et.insertBefore(c,Et.children[n]||null)):Et.appendChild(c),X.buttons[e]=t}},V.separator=function(e){e=e||{};var t,n=F.createElement("span");if(n.className=Ct.toolbarSeparatorClass,a(e.attr))for(var i in e.attr)if(l(e.attr[i])&&"+="==e.attr[i].slice(0,2)){var o=n.getAttribute(i)||"";n.setAttribute(i,o+e.attr[i].slice(2))}else n.setAttribute(i,e.attr[i]);r(e.position)?(t=e.position<0?e.position+Et.children.length+1:e.position-1,Et.insertBefore(n,Et.children[t]||null)):Et.appendChild(n)},j.toggle=function(e,t,n,l){var r=bt();if(r.before.slice(-e.length)!=e&&r.after.slice(0,t.length)!=t)kt(e,t,0===r.value.length&&l?function(){mt(/^.*$/,l===!0?Ct.placeholders.text:l)}:1);else{var a=r.before.slice(-e.length)==e?r.before.slice(0,-e.length):r.before,o=r.after.slice(0,t.length)==t?r.after.slice(t.length):r.after;pt.value=a+r.value+o,vt(a.length,a.length+r.value.length,xt)}i(n)&&n()};var Lt=j.toggle,St=0,Ht=Ct.buttons,Ot={bold:{title:Ht.bold,click:function(){var e=Ct.STRONG;Lt("<"+e+">","</"+e.split(" ")[0]+">",1,!0)}},italic:{title:Ht.italic,click:function(){var e=Ct.EM;Lt("<"+e+">","</"+e.split(" ")[0]+">",1,!0)}},underline:{title:Ht.underline,click:function(){var e=Ct.U;Lt("<"+e+">","</"+e.split(" ")[0]+">",1,!0)}},strikethrough:{title:Ht.strike,click:function(){var e=V.time(),t=Ct.STRIKE;t=t.replace(/%Y/g,e.Y).replace(/%m/g,e.m).replace(/%d/g,e.d).replace(/%H/g,e.H).replace(/%i/g,e.i).replace(/%s/g,e.s).replace(/%u/g,e.u),Lt("<"+t+">","</"+t.split(" ")[0]+">",1,!0)}},code:{title:Ht.code,click:function(){var e=bt().value,t=Ct.CODE,n=Ct.PRE,l=t.split(" ")[0],r=n.split(" ")[0],i=-1===e.indexOf("\n"),a=i?"<"+t+">":"<"+n+"><"+t+">",o=i?"</"+l+">":"</"+l+"></"+r+">";if(e.length>0){var c=bt(),u=c.before,s=c.after,f=c.value,p=g(l),d=g(r);u.match(RegExp("(<"+d+"(>| .*?>))?<"+p+"(>| .*?>)$"))&&s.match(RegExp("^<\\/"+p+">(<\\/"+d+">)?"))?(u=u.replace(RegExp("(<"+d+"(>| .*?>))?<"+p+"(>| .*?>)$"),""),s=s.replace(RegExp("^<\\/"+p+">(<\\/"+d+">)?"),""),Ct.autoEncodeHTML&&(f=f.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">")),pt.value=u+f+s,vt(u.length,u.length+f.length,xt)):(Ct.autoEncodeHTML&&(f=f.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),pt.value=u+a+f+o+s,vt(u.length+a.length,u.length+f.length+a.length,xt))}else Lt(a,o,1,!0)}},paragraph:{title:Ht.paragraph,click:function(){var e=bt().value,t=Ct.P,n=t.split(" ")[0],l=g(n);e.length>0?RegExp("^<"+l+"(>| .*?>)|<\\/"+l+">$").test(e)?mt(RegExp("<"+l+"(>| .*?>)([\\s\\S]*?)<\\/"+l+">","g"),"$2"):(mt(/^/,"<"+t+">",ft),mt(/$/,"</"+n+">",ft),mt(/\n/g,"</"+n+">\n<"+t+">",ft),mt(RegExp("<"+n+"(>| .*?>)<\\/"+n+">","g"),"",ft),mt(RegExp("(<"+n+"(>| .*?>))+","g"),"$1",ft),mt(RegExp("(<\\/"+n+">)+","g"),"$1")):Lt("<"+t+">","</"+n+">")}},"quote-right":{title:Ht.quote,click:function(){var e=bt(),t=Ct.QUOTE,n=Ct.BLOCKQUOTE;0===e.start||e.before.match(/\n$/)?Lt("<"+n+">","</"+n.split(" ")[0]+">",1,!0):e.before.match(RegExp("<"+n.split(" ")[0]+"(>| .*?>)$"))?Lt("<"+n+">","</"+n.split(" ")[0]+">",1,!0):Lt("<"+t+">","</"+t.split(" ")[0]+">",1,!0)}},header:{title:Ht.heading,click:function(){var e,t,n,l=bt(),r=Ct.H_,i=r.split(" ")[0],a=g(i).replace(/%d/g,"[1-6]"),o=Ct.P,c=o.split(" ")[0],u=g(c),s="<\\/?(?:"+a+"|"+u+")(>| .*?>)",h=d(l.before.replace(RegExp(s+"$"),"")).length>0?"\n\n":"",m=d(l.before.replace(RegExp(s+"$","g"),"")),v=f(l.value.replace(RegExp("^"+s+"|"+s+"$","g"),"").replace(/\n+/g," ")),b=p(l.after.replace(RegExp("^"+s,"g"),"")),x=l.value.match(RegExp("^"+s))?RegExp("^"+s).exec(l.value):RegExp(s+"$").exec(l.before);if(x=x?x[1]:">",St=6>St?St+1:0,l.value.length>0)l.before.match(RegExp(s+"$"))?(n=i.replace(/%d/g,St),pt.value=m+h+"<"+(St>0?n:c)+x+v+"</"+(St>0?n:c)+">\n\n"+b,e=m.length+h.length+1+(St>0?n.length:c.length)+x.length):(t=r.replace(/%d/g,St),n=i.replace(/%d/g,St),pt.value=m+h+"<"+(St>0?t:o)+x+v+"</"+(St>0?n:c)+">\n\n"+b,e=m.length+h.length+1+(St>0?t.length:o.length)+x.length),vt(e,e+v.length,xt);else{var k=Ct.placeholders.heading_text;r=r.replace(/%d/g,1),i=i.replace(/%d/g,1),St=1,pt.value=d(l.before)+h+"<"+r+">"+k+"</"+i+">\n\n"+p(l.after),e=d(l.before).length+h.length+1+r.length+1,vt(e,e+k.length,xt)}}},link:{title:Ht.link,click:function(e){var t,n,l=bt(),r=Ct.A,i=r.split(" ")[0],a=Ct.placeholders.link_text;V.prompt(Ct.prompts.link_url_title,Ct.prompts.link_url,!0,function(o){n=o,V.prompt(Ct.prompts.link_title_title,Ct.prompts.link_title,!1,function(o){t=o.replace(/'/g,"&apos;").replace(/"/g,"&quot;"),kt("<"+r+' href="'+n+'"'+(""!==t?' title="'+t+'"':"")+">","</"+i+">",0===l.value.length?function(){mt(/^/,a)}:1),Ct.update(e,V)})})}},image:{title:Ht.image,click:function(e){V.prompt(Ct.prompts.image_url_title,Ct.prompts.image_url,!0,function(t){var n=bt(),l=d(n.before),r=p(n.after),i=l.length>0?"\n\n":"",a=Ct.emptyElementSuffix,o=decodeURIComponent(t.substring(t.lastIndexOf("/")+1,t.lastIndexOf(".")).replace(/[-+._]+/g," ")).toLowerCase().replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()});o=-1===o.indexOf("/")&&-1!==t.indexOf(".")?o:Ct.placeholders.image_alt,pt.value=l+i+"<"+Ct.IMG+' alt="'+o+'" src="'+t+'"'+a+"\n\n"+r,vt(l.length+i.length+1+Ct.IMG.length+6+o.length+7+t.length+1+a.length+2,function(){Ct.update(e,V),xt()})})}},"list-ol":{title:Ht.ol,click:function(){m(Ct.OL,Ct.placeholders.list_ol_text)}},"list-ul":{title:Ht.ul,click:function(){m(Ct.UL,Ct.placeholders.list_ul_text)}},superscript:{title:Ht.superscript,click:function(){var e=Ct.SUP;Lt("<"+e+">","</"+e.split(" ")[0]+">",1,!0)}},subscript:{title:Ht.subscript,click:function(){var e=Ct.SUB;Lt("<"+e+">","</"+e.split(" ")[0]+">",1,!0)}},"ellipsis-h":{title:Ht.rule,click:function(){var e=bt(),t=d(e.before),n=p(e.after),l=t.length>0?"\n\n":"",r=Ct.HR,i=Ct.emptyElementSuffix;pt.value=t+l+"<"+r+i+"\n\n"+n,vt(t.length+l.length+1+r.length+i.length+2,xt)}},undo:{title:Ht.undo,click:j.undo},repeat:{title:Ht.redo,click:j.redo}};for(var _t in Ot)V.button(_t,Ot[_t]);o(pt,"focus",V.close),o(pt,"copy",function(e){var t=bt();W.setTimeout(function(){Ct.copy(t),Ct.update(e,V)},1)}),o(pt,"cut",function(e){var t=bt();W.setTimeout(function(){t.end=t.start,Ct.cut(t),Ct.update(e,V),xt()},1)}),o(pt,"paste",function(e){var t=bt();W.setTimeout(function(){t.end=bt().end,t.value=pt.value.substring(t.start,t.end),Ct.paste(t),Ct.update(e,V),xt()},1)}),o(pt,"keydown",function(e){var t=bt(),n=t.before,l=t.value,r=t.after,i=t.start,a=t.end,o=e.keyCode,c=e.ctrlKey,u=e.shiftKey,f=e.altKey,p=9==o;W.setTimeout(function(){Ct.keydown(e,V),Ct.update(e,V)},1);var d=n,h=r[0],m="\\"==d.slice(-1);if(-1!==d.indexOf("(")&&u&&48==o&&")"==h&&!m||-1!==d.indexOf("{")&&u&&221==o&&"}"==h&&!m||-1!==d.indexOf("[")&&221==o&&"]"==h&&!m||-1!==d.indexOf('"')&&u&&222==o&&'"'==h&&!m||-1!==d.indexOf("'")&&!u&&222==o&&"'"==h&&!m||-1!==d.indexOf("`")&&!u&&192==o&&"`"==h&&!m||-1!==d.indexOf("<")&&u&&190==o&&">"==h&&!m)return vt(a+1),!1;if(u&&57==o&&!m)return s("("+l+")",t);if(u&&219==o&&!m)return s("{"+l+"}",t);if(!u&&219==o&&!m)return s("["+l+"]",t);if(u&&222==o&&!m)return s('"'+l+'"',t);if(!u&&222==o&&!m)return s("'"+l+"'",t);if(!u&&192==o&&!m)return s("`"+l+"`",t);if(u&&188==o&&!m)return s("<"+l+">",t);if(u&&p)return ht(Ct.tabSize),!1;if(p){if(n.match(/<[^\/>]*?$/)&&">"==r[0]){var F=/<([^\/>]*?)$/.exec(n);return pt.value=n+" "+l+"></"+F[1].split(" ")[0]+r,vt(i+1,xt),!1}return dt(Ct.tabSize),!1}if(c&&90==o)return j.undo(),!1;if(c&&89==o)return j.redo(),!1;if(Ct.shortcut){if(c&&66==o)return Ot.bold.click(),!1;if(c&&71==o)return Ot.image.click(),!1;if(c&&72==o)return Ot.header.click(),!1;if(c&&73==o)return Ot.italic.click(),!1;if(c&&!u&&75==o)return Ot.code.click(),!1;if(c&&76==o)return Ot.link.click(),!1;if(c&&81==o)return Ot["quote-right"].click(),!1;if(c&&82==o)return Ot["ellipsis-h"].click(),!1;if(c&&85==o)return Ot.underline.click(),!1;if(l.length>0&&46==o)return Ot.strikethrough.click(),!1;if(c&&49==o)return Ot["list-ol"].click(),!1;if(c&&173==o)return Ot["list-ul"].click(),!1}if(13==o){if(f&&0===l.length)return gt(G),!1;if(c)return Ot.paragraph.click(),!1;if(u)return gt("<"+Ct.BR+Ct.emptyElementSuffix+"\n"),V.scroll(),!1;var X=Ct.LI.split(" ")[0];if(n.match(RegExp("<\\/"+Tt+">$"))){var F=RegExp("(?:^|\\n)([\\t ]*)<"+Tt+"(>| .*?>).*?<\\/"+Tt+">$").exec(n);return gt("\n"+F[1]+"<"+X+F[2]+"</"+X+">",function(){vt(a+F[1].length+F[2].length+4,xt)}),V.scroll(),!1}if(r.match(RegExp("^<\\/"+Tt+">"))&&">"!=n.slice(-1)){var F=RegExp("(?:^|\\n)([\\t ]*)<"+Tt+"(>| .*?>).*$").exec(n);return gt("</"+X+">\n"+F[1]+"<"+X+F[2]),V.scroll(),!1}var J=Ct.P.split(" ")[0];if(r.match(RegExp("^<\\/"+$t+">"))){var F=RegExp("(?:^|\\n?)([\\t ]*)<"+$t+"(>| .*?>).*$").exec(n);return gt("</"+J+">\n"+F[1]+"<"+J+F[2]),V.scroll(),!1}var Z=RegExp("(?:^|\\n)(("+yt+")+)(.*?)$").exec(n),et=Z?Z[1]:"";return n.match(/[\(\{\[]$/)&&r.match(/^[\]\}\)]/)||n.match(/<[^\/>]*?>$/)&&r.match(/^<\//)?(gt("\n"+et+Ct.tabSize+"\n"+et,function(){vt(i+et.length+Ct.tabSize.length+1,xt)}),V.scroll(),!1):(gt("\n"+et),V.scroll(),!1)}var tt={"'":b,'"':k,"---":E,"--":C,"...":y,"|":$,"(c)":T,"(C)":T,"(p)":R,"(P)":R,"(sm)":L,"(SM)":L," sm":L," SM":L,"(tm)":S,"(TM)":S," tm":S," TM":S,"(r)":H,"(R)":H,"+-":O,"-+":O,x:_,"/":M,"^":w,"<<":I,">>":U,"<":N,">":z,"<=":B,">=":A,"!=":P,".":Q};if(l.length>0){if(f){mt(/'([^']*?)'/g,v+"$1"+b,ft),mt(/"([^"]*?)"/g,x+"$1"+k,ft);for(var nt in tt)mt(RegExp(g(nt),"g"),tt[nt],ft);return xt(),!1}}else{if(f){if(-1!==n.indexOf('"')&&'"'==r[0])return pt.value=n.replace(/"([^"]*?)$/,x+"$1")+k+r.slice(1),vt(a,xt),!1;if(-1!==n.indexOf("'")&&"'"==r[0])return pt.value=n.replace(/'([^']*?)$/,v+"$1")+b+r.slice(1),vt(a,xt),!1;if(n.slice(-2).match(/\w'$/i))return pt.value=n.slice(0,-1)+b+r,vt(a,xt),!1;if(n.match(/\((c|p|sm|tm|r)$/i)&&")"==r[0]){var lt=n.match(/\((sm|tm)$/i)?2:1;return pt.value=n.slice(0,-(lt+1))+tt["("+n.slice(-lt).toLowerCase()+")"]+r.slice(1),vt(a-lt,xt),!1}var rt=n.replace(/&lt;/g,"<").replace(/&gt;/g,">"),it=r.replace(/&lt;/g,"<").replace(/&gt;/g,">");if(-1!==rt.indexOf("<<")&&0===it.indexOf(">>"))return pt.value=n.replace(/(?:<<|&lt;&lt;)([^<]*)$/,I+"$1")+r.replace(/^(?:>>|&gt;&gt;)/,U),vt(rt.length-1,xt),!1;if(-1!==rt.indexOf("<")&&0===it.indexOf(">"))return pt.value=n.replace(/(?:<|&lt;)([^<]*)$/,N+"$1")+r.replace(/^(?:>|&gt;)/,z),vt(rt.length,xt),!1;for(var nt in tt)if(n.slice(-nt.length)==nt)return pt.value=n.slice(0,-nt.length)+tt[nt]+r,vt(i-nt.length+1,xt),!1;if(37==o)return gt(K),!1;if(38==o)return gt(Y),!1;if(39==o)return gt(q),!1;if(40==o)return gt(D),!1}if(8==o){if(n.match(RegExp(yt+"$")))return ht(Ct.tabSize),!1;if(n.match(/<\/?[^>]*?>$/))return ht("</?[^>]*?>",1,!0),!1;switch(n.slice(-1)){case"(":return Lt("(",")"),!1;case"{":return Lt("{","}"),!1;case"[":return Lt("[","]"),!1;case'"':return Lt('"','"'),!1;case"'":return Lt("'","'"),!1;case"<":return Lt("<",">"),!1;case x:return Lt(x,k),!1;case v:return Lt(v,b),!1;case I:return Lt(I,U),!1;case N:return Lt(N,z),!1}}}return 39==o&&r.match(/^<\/.*?>/)?(vt(a+r.indexOf(">")+1),!1):27==o?(Rt.focus(),!1):void(f||c||u||W.setTimeout(xt,1))});var Mt=RegExp("(^|\\s)"+Ct.areaClass+"(\\s|$)"),wt=pt.className;wt.match(Mt)||(pt.className=f(wt+" "+Ct.areaClass)),Ct.ready(V),V.grip=j,V.grip.config=Ct};