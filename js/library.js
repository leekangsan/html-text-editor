/*!
 * --------------------------------------------------------------------
 *  SIMPLE TEXT SELECTION LIBRARY FOR ONLINE TEXT EDITING (2015-02-23)
 * --------------------------------------------------------------------
 * Source code available at https://github.com/tovic/simple-text-editor-library
 *
 */

var Editor=function(e){var t=this,n=document,l=[],i=0,r=null;t.area=void 0!==e?e:n.getElementsByTagName("textarea")[0],l[i]={value:t.area.value,selectionStart:0,selectionEnd:0},i++,t.selection=function(){var e=t.area.value.replace(/\r/g,""),n=t.area.selectionStart,l=t.area.selectionEnd,i=e.substring(n,l),r=e.substring(0,n),o=e.substring(l),a={start:n,end:l,value:i,before:r,after:o};return a},t.select=function(e,l,i){var r=n.documentElement.scrollTop,o=n.body.scrollTop,a=t.area.scrollTop;t.area.focus(),void 0===l&&(l=e),"function"==typeof l&&void 0===i&&(i=l,l=e),t.area.setSelectionRange(e,l),n.documentElement.scrollTop=r,n.body.scrollTop=o,t.area.scrollTop=a,"function"==typeof i&&i()},t.replace=function(e,n,l){var i=t.selection(),r=i.start,o=(i.end,i.value.replace(e,n));t.area.value=i.before+o+i.after,t.select(r,r+o.length),"function"==typeof l?l():t.updateHistory({value:t.area.value,selectionStart:r,selectionEnd:r+o.length})},t.insert=function(e,n){{var l=t.selection(),i=l.start;l.end}t.area.value=l.before+e+l.after,t.select(i+e.length),"function"==typeof n?n():t.updateHistory({value:t.area.value,selectionStart:i+e.length,selectionEnd:i+e.length})},t.wrap=function(e,n,l){var i=t.selection(),r=i.value,o=i.before,a=i.after;t.area.value=o+e+r+n+a,t.select(o.length+e.length,o.length+e.length+r.length),"function"==typeof l?l():t.updateHistory({value:t.area.value,selectionStart:o.length+e.length,selectionEnd:o.length+e.length+r.length})},t.indent=function(e,n){var l=t.selection();l.value.length>0?t.replace(/(^|\n)([^\n])/gm,"$1"+e+"$2",n):(t.area.value=l.before+e+l.value+l.after,t.select(l.start+e.length),"function"==typeof n?n():t.updateHistory({value:t.area.value,selectionStart:l.start+e.length,selectionEnd:l.start+e.length}))},t.outdent=function(e,n){var l=t.selection();if(l.value.length>0)t.replace(RegExp("(^|\n)"+e,"gm"),"$1",n);else{var i=l.before.replace(RegExp(e+"$"),"");t.area.value=i+l.value+l.after,t.select(i.length),"function"==typeof n?n():t.updateHistory({value:t.area.value,selectionStart:i.length,selectionEnd:i.length})}},t.callHistory=function(e){return"number"==typeof e?l[e]:l},t.updateHistory=function(e,n){var r=void 0!==e?e:{value:t.area.value,selectionStart:t.selection().start,selectionEnd:t.selection().end};l["number"==typeof n?n:i]=r,i++},t.undo=function(e){if(l.length>1){i>1?i--:i=1;var n=t.callHistory(i-1);r=i>0?i:i-1,t.area.value=n.value,t.select(n.selectionStart,n.selectionEnd),"function"==typeof e&&e()}},t.redo=function(e){if(null!==r){var n=t.callHistory(r);r<l.length-1?r++:r=l.length-1,i=r<l.length-1?r:r+1,t.area.value=n.value,t.select(n.selectionStart,n.selectionEnd),"function"==typeof e&&e()}}};