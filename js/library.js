/*!
 * --------------------------------------------------------------------
 *  SIMPLE TEXT SELECTION LIBRARY FOR ONLINE TEXT EDITING (2014-03-19)
 * --------------------------------------------------------------------
 * Source code available at https://github.com/tovic/simple-text-editor-library
 *
 */

;var Editor=function(d){var c=this,e=[],a=0,b=null;c.area=typeof d!="undefined"?d:document.getElementsByTagName("textarea")[0];e[a]={value:c.area.value,selectionStart:0,selectionEnd:0};a++;c.selection=function(){var k=c.area.selectionStart,f=c.area.selectionEnd,i=c.area.value.substring(k,f),h=c.area.value.substring(0,k),j=c.area.value.substring(f),g={start:k,end:f,value:i,before:h,after:j};return g};c.select=function(h,f,g){c.area.focus();c.area.setSelectionRange(h,f);if(typeof g=="function"){g()}};c.replace=function(l,k,j){var h=c.selection(),i=h.start,f=h.end,g=h.value.replace(l,k);c.area.value=h.before+g+h.after;c.select(i,i+g.length);if(typeof j=="function"){j()}else{c.updateHistory({value:c.area.value,selectionStart:i,selectionEnd:i+g.length})}};c.insert=function(h,j){var g=c.selection(),i=g.start,f=g.end;c.area.value=g.before+h+g.after;c.select(i+h.length,i+h.length);if(typeof j=="function"){j()}else{c.updateHistory({value:c.area.value,selectionStart:i+h.length,selectionEnd:i+h.length})}};c.wrap=function(f,k,l){var i=c.selection(),g=i.value,h=i.before,j=i.after;c.area.value=h+f+g+k+j;c.select(h.length+f.length,h.length+f.length+g.length);if(typeof l=="function"){l()}else{c.updateHistory({value:c.area.value,selectionStart:h.length+f.length,selectionEnd:h.length+f.length+g.length})}};c.indent=function(f,h){var g=c.selection();if(g.value.length>0){c.replace(/(^|\n)([^\n])/gm,"$1"+f+"$2",h)}else{c.area.value=g.before+f+g.value+g.after;c.select(g.start+f.length,g.start+f.length);if(typeof h=="function"){h()}else{c.updateHistory({value:c.area.value,selectionStart:g.start+f.length,selectionEnd:g.start+f.length})}}};c.outdent=function(f,i){var h=c.selection();if(h.value.length>0){c.replace(new RegExp("(^|\n)"+f,"gm"),"$1",i)}else{var g=h.before.replace(new RegExp(f+"$"),"");c.area.value=g+h.value+h.after;c.select(g.length,g.length);if(typeof i=="function"){i()}else{c.updateHistory({value:c.area.value,selectionStart:g.length,selectionEnd:g.length})}}};c.callHistory=function(f){return(typeof f=="number")?e[f]:e};c.updateHistory=function(h,f){var g=(typeof h!="undefined")?h:{value:c.area.value,selectionStart:c.selection().start,selectionEnd:c.selection().end};e[typeof f=="number"?f:a]=g;a++};c.undo=function(g){if(e.length>1){if(a>1){a--}else{a=1}var f=c.callHistory(a-1);b=a<=0?a-1:a}else{return}c.area.value=f.value;c.select(f.selectionStart,f.selectionEnd);if(typeof g=="function"){g()}};c.redo=function(g){if(b!==null){var f=c.callHistory(b);if(b<e.length-1){b++}else{b=e.length-1}a=b>=e.length-1?b+1:b}else{return}c.area.value=f.value;c.select(f.selectionStart,f.selectionEnd);if(typeof g=="function"){g()}}};